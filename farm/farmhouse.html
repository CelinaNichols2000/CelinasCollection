<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Celina's Farmhouse - Intimate Encounters</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="farmhouse.css">
</head>
<body>
    <!-- HEADER NAVIGATION -->
    <header class="farmhouse-header">
        <nav class="farmhouse-nav">
            <button class="nav-btn nav-back" id="backToForest" title="Return to the forest">
                <span class="nav-icon">←</span>
                <span class="nav-text">Back to Forest</span>
            </button>
            <div class="nav-title-container">
                <h1 class="nav-title">Celina's Farmhouse</h1>
                <p class="nav-subtitle">Where secrets hide behind every door...</p>
            </div>
            <button class="nav-btn nav-menu" id="menuToggle" title="Open menu">
                <span class="nav-icon">[=]</span>
            </button>
        </nav>

        <!-- MOBILE MENU -->
        <div class="mobile-menu" id="mobileMenu" style="display: none;">
            <div class="mobile-menu-content">
                <button class="menu-close" id="menuClose">[X]</button>
                <div class="menu-stats" id="menuStats"></div>
                <button class="menu-item" id="menuReturnMap">[M] Return to Map</button>
                <button class="menu-item" id="menuExit">[E] Exit Farmhouse</button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="farmhouse-main">
        <!-- MAP VIEW -->
        <div class="map-view" id="mapView">
            <div class="map-container">
                <div class="map-header">
                    <h2 class="map-title">[Explore the Farmhouse]</h2>
                    <p class="map-subtitle">Each door holds untold pleasures and transformations... Click to enter.</p>
                </div>

                <!-- LOCATIONS GRID -->
                <div class="locations-grid" id="locationsGrid">
                    
                    <!-- MAIN HALL - SCARLET -->
                    <div class="location-card" data-location="main-hall" data-character="scarlet">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Main+Hall&bg=8B3A62&fg=FFFFFF" alt="Main Hall" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Main Hall</span>
                                <span class="location-intensity">★★★</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Entrance Hall</h3>
                            <p class="location-desc">The mistress of this mysterious house awaits... Scarlet's commands are absolute.</p>
                            <div class="location-character">
                                <span class="char-emoji">[S]</span>
                                <span class="char-name">Scarlet</span>
                                <span class="char-role">Mistress</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Animal</span>
                        </div>
                    </div>

                    <!-- KITCHEN - MAIDEN IRIS -->
                    <div class="location-card" data-location="kitchen" data-character="iris">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Kitchen&bg=D4A574&fg=FFFFFF" alt="Kitchen" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Kitchen</span>
                                <span class="location-intensity">★★☆</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Cozy Kitchen</h3>
                            <p class="location-desc">A helpful maid works among the pots and pans. Her cooking has... special ingredients.</p>
                            <div class="location-character">
                                <span class="char-emoji">[I]</span>
                                <span class="char-name">Iris</span>
                                <span class="char-role">Maid</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Mindless Servitude</span>
                        </div>
                    </div>

                    <!-- GARDEN ROOM - AELINDOR (Elf) -->
                    <div class="location-card" data-location="garden-room" data-character="aelindor">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Garden&bg=4A7C59&fg=FFFFFF" alt="Garden Room" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Garden</span>
                                <span class="location-intensity">★★☆</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Garden Room</h3>
                            <p class="location-desc">An elegant elf tends to exotic plants. Strange flowers bloom only for her touch.</p>
                            <div class="location-character">
                                <span class="char-emoji">[A]</span>
                                <span class="char-name">Aelindor</span>
                                <span class="char-role">Elf Enchantress</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Absorption</span>
                        </div>
                    </div>

                    <!-- LIBRARY - SPARKLE (Fairy) -->
                    <div class="location-card" data-location="library" data-character="sparkle">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Library&bg=2D5A5D&fg=FFFFFF" alt="Library" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Library</span>
                                <span class="location-intensity">★★★</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Enchanted Library</h3>
                            <p class="location-desc">A mischievous fairy hides among the books. Her spells are written in invisible ink.</p>
                            <div class="location-character">
                                <span class="char-emoji">[F]</span>
                                <span class="char-name">Sparkle</span>
                                <span class="char-role">Trickster Fairy</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Inanimate</span>
                        </div>
                    </div>

                    <!-- PRIVATE CHAMBER - LILY (18yo) -->
                    <div class="location-card" data-location="bedroom" data-character="lily">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Bedroom&bg=C94E7F&fg=FFFFFF" alt="Private Chamber" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Bedroom</span>
                                <span class="location-intensity">★★★</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Private Chamber</h3>
                            <p class="location-desc">A young 18-year-old beauty in her sanctuary. She has... particular talents.</p>
                            <div class="location-character">
                                <span class="char-emoji">[L]</span>
                                <span class="char-name">Lily</span>
                                <span class="char-role">Animal Tamer</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Animal</span>
                        </div>
                    </div>

                    <!-- CRAFT ROOM - AMY -->
                    <div class="location-card" data-location="craft-room" data-character="amy">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Workshop&bg=e67e22&fg=FFFFFF" alt="Craft Workshop" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Workshop</span>
                                <span class="location-intensity">★★☆</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Craft Workshop</h3>
                            <p class="location-desc">A tiny woman with enormous power. She transforms guests into animals that she can control and ride.</p>
                            <div class="location-character">
                                <span class="char-emoji">[A]</span>
                                <span class="char-name">Amy</span>
                                <span class="char-role">Beast Tamer</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Animal</span>
                        </div>
                    </div>

                    <!-- BASEMENT - MORRIGAN (Potion Brewer) -->
                    <div class="location-card" data-location="basement" data-character="morrigan">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Basement&bg=1a1a1a&fg=FFFFFF" alt="Potion Cellar" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Basement</span>
                                <span class="location-intensity">★★★</span>
                            </div>
                            <div class="location-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Potion Cellar</h3>
                            <p class="location-desc">A dark alchemist who transforms people into small animals. Her experiments are fascinating and permanent.</p>
                            <div class="location-character">
                                <span class="char-emoji">[M]</span>
                                <span class="char-name">Morrigan</span>
                                <span class="char-role">Alchemist</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="transformation-type">Animal</span>
                        </div>
                    </div>

                    <!-- RANDOM ENCOUNTERS CARD -->
                    <div class="location-card encounters-card" id="randomEncountersCard">
                        <div class="location-image-wrapper">
                            <img src="https://via.placeholder.com/280x180?text=Mystery&bg=4B0082&fg=FFFFFF" alt="Random Encounter" class="location-image">
                            <div class="location-overlay">
                                <span class="location-label">Mystery</span>
                                <span class="location-intensity">★★★★</span>
                            </div>
                            <div class="location-glow random-glow"></div>
                        </div>
                        <div class="location-info">
                            <h3 class="location-name">Random Encounter</h3>
                            <p class="location-desc">Something unexpected happens in the house. Fate is unpredictable...</p>
                            <div class="location-character">
                                <span class="char-emoji">[?]</span>
                                <span class="char-name">Destiny</span>
                                <span class="char-role">Mysterious Force</span>
                            </div>
                        </div>
                        <div class="location-footer">
                            <span class="interaction-count">Once/Cycle</span>
                            <span class="transformation-type">Surprise!</span>
                        </div>
                    </div>

                </div>

                <!-- MAP LEGEND -->
                <div class="map-legend">
                    <div class="legend-section">
                        <h3 class="legend-title">[How to Play]</h3>
                        <div class="legend-items">
                            <div class="legend-item">
                                <span class="legend-icon">[L]</span>
                                <span class="legend-text">Each location has <strong>9 stages</strong> of dialogue and interaction</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon">[+]</span>
                                <span class="legend-text">Random encounters <strong>rotate</strong> - no repeats until all 4 used</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon">[*]</span>
                                <span class="legend-text">Your choices <strong>affect transformation</strong> progression</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon">[~]</span>
                                <span class="legend-text">Some stages have <strong>no choices</strong> - progression is inevitable</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon">[*]</span>
                                <span class="legend-text"><strong>Intensity level</strong> indicates transformation power</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon">[=]</span>
                                <span class="legend-text">Progress is <strong>automatically saved</strong> to your device</span>
                            </div>
                        </div>
                    </div>

                    <!-- TRANSFORMATION TYPES INFO -->
                    <div class="legend-section">
                        <h3 class="legend-title">[Transformation Types]</h3>
                        <div class="transformation-info">
                            <div class="transform-item">
                                <span class="transform-icon">[A]</span>
                                <span class="transform-name">Animal</span>
                                <span class="transform-desc">Physical beast transformation with instinct override</span>
                            </div>
                            <div class="transform-item">
                                <span class="transform-icon">[B]</span>
                                <span class="transform-name">Bimbo</span>
                                <span class="transform-desc">Mental degradation with enhanced sensuality</span>
                            </div>
                            <div class="transform-item">
                                <span class="transform-icon">[P]</span>
                                <span class="transform-name">Plant</span>
                                <span class="transform-desc">Nature absorption and rooting mechanics</span>
                            </div>
                            <div class="transform-item">
                                <span class="transform-icon">[O]</span>
                                <span class="transform-name">Object</span>
                                <span class="transform-desc">Inanimate conversion with consciousness trapped</span>
                            </div>
                            <div class="transform-item">
                                <span class="transform-icon">[F]</span>
                                <span class="transform-name">Flux</span>
                                <span class="transform-desc">Constant transformation between multiple states</span>
                            </div>
                        </div>
                    </div>

                    <!-- GAME MECHANICS INFO -->
                    <div class="legend-section">
                        <h3 class="legend-title">[Game Mechanics]</h3>
                        <div class="mechanics-info">
                            <div class="mechanic-item">
                                <span class="mechanic-label">Affinity:</span>
                                <span class="mechanic-desc">Your closeness to each character. Affects dialogue options available.</span>
                            </div>
                            <div class="mechanic-item">
                                <span class="mechanic-label">Transformation:</span>
                                <span class="mechanic-desc">Cumulative change level. Determines which endings are accessible.</span>
                            </div>
                            <div class="mechanic-item">
                                <span class="mechanic-label">Risk Level:</span>
                                <span class="mechanic-desc">Current danger of critical transformation. Higher = more permanent.</span>
                            </div>
                            <div class="mechanic-item">
                                <span class="mechanic-label">Stage Progression:</span>
                                <span class="mechanic-desc">9 stages per character. Some auto-advance, some require choices.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- INTERACTION VIEW -->
        <div class="interaction-view" id="interactionView" style="display: none;">
            <div class="interaction-container">
                
                <!-- CHARACTER PANEL (LEFT SIDE) -->
                <div class="character-panel">
                    <div class="character-header">
                        <button class="close-interaction" id="closeInteraction" title="Return to map">
                            ←
                        </button>
                        <div class="character-title-block">
                            <h2 class="character-name" id="charName">Character</h2>
                            <p class="character-role" id="charRole">Role</p>
                        </div>
                        <div class="character-badge" id="charBadge">Location</div>
                    </div>

                    <div class="character-visual">
                        <img src="https://via.placeholder.com/240x240?text=Character" alt="Character" class="character-image" id="charImage">
                        <div class="character-aura"></div>
                    </div>

                    <!-- CHARACTER STATS -->
                    <div class="character-stats-section">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-label">Stage</span>
                                <span class="stat-value" id="stageNumber">1/9</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Affinity</span>
                                <span class="stat-value" id="affinityValue">0%</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Transform</span>
                                <span class="stat-value" id="transformValue">0%</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Risk</span>
                                <span class="stat-value" id="riskValue">Low</span>
                            </div>
                        </div>

                        <!-- AFFINITY PROGRESS BAR -->
                        <div class="progress-container">
                            <div class="progress-label">
                                <span class="progress-label-text">Affinity Progress</span>
                            </div>
                            <div class="progress-bar affinity-bar">
                                <div class="progress-fill" id="affinityBar" style="width: 0%;"></div>
                            </div>
                        </div>

                        <!-- TRANSFORMATION PROGRESS BAR -->
                        <div class="progress-container">
                            <div class="progress-label">
                                <span class="progress-label-text">Transformation Progress</span>
                            </div>
                            <div class="progress-bar transform-bar">
                                <div class="progress-fill transform-fill" id="transformBar" style="width: 0%;"></div>
                            </div>
                        </div>

                        <!-- RISK INDICATOR -->
                        <div class="risk-indicator">
                            <div class="risk-label">⚠️ Transformation Risk</div>
                            <div class="risk-bar">
                                <div class="risk-fill" id="riskBar" style="width: 0%;"></div>
                            </div>
                            <div class="risk-description" id="riskDescription">Safe - Reversible changes</div>
                        </div>
                    </div>

                    <!-- CHARACTER DETAILS -->
                    <div class="character-details">
                        <div class="details-section">
                            <h4 class="details-title">About This Character</h4>
                            <p class="details-text" id="charDetails">Loading character information...</p>
                        </div>
                        <div class="details-section">
                            <h4 class="details-title">Transformation Focus</h4>
                            <p class="details-text" id="charTransformType">Loading transformation type...</p>
                        </div>
                    </div>
                </div>

                <!-- DIALOGUE PANEL (RIGHT SIDE) -->
                <div class="dialogue-panel">
                    <div class="dialogue-container">
                        <div class="dialogue-header">
                            <div class="dialogue-character">
                                <span class="dialogue-name" id="dialogueName">Character</span>
                                <span class="dialogue-stage" id="dialogueStage">Stage 1</span>
                            </div>
                            <div class="stage-progress">
                                <div class="progress-bar small-bar">
                                    <div class="progress-fill" id="stageProgressFill" style="width: 11%;"></div>
                                </div>
                                <span class="progress-text" id="progressText">Stage 1 of 9</span>
                            </div>
                        </div>

                        <!-- DIALOGUE BOX -->
                        <div class="dialogue-box" id="dialogueBox">
                            <div class="dialogue-content" id="dialogueContent">
                                <p id="dialogueText">Loading conversation...</p>
                            </div>
                            <div class="dialogue-emotes" id="dialogueEmotes"></div>
                        </div>

                        <!-- DIALOGUE IMAGE (Optional) -->
                        <div class="dialogue-image-container" id="dialogueImageContainer" style="display: none;">
                            <img src="https://via.placeholder.com/400x250?text=Interaction" alt="Interaction" class="dialogue-image" id="dialogueImage">
                        </div>
                    </div>

                    <!-- CHOICES SECTION -->
                    <div class="choices-container" id="choicesContainer">
                        <div class="choices-title">Choose Your Path:</div>
                        
                        <button class="choice-btn choice-btn-1" id="choice1" style="display: none;">
                            <span class="choice-icon">A</span>
                            <span class="choice-content">
                                <span class="choice-text">Option</span>
                                <span class="choice-risk"></span>
                            </span>
                        </button>
                        
                        <button class="choice-btn choice-btn-2" id="choice2" style="display: none;">
                            <span class="choice-icon">B</span>
                            <span class="choice-content">
                                <span class="choice-text">Option</span>
                                <span class="choice-risk"></span>
                            </span>
                        </button>
                        
                        <button class="choice-btn choice-btn-3" id="choice3" style="display: none;">
                            <span class="choice-icon">C</span>
                            <span class="choice-content">
                                <span class="choice-text">Option</span>
                                <span class="choice-risk"></span>
                            </span>
                        </button>
                        
                        <button class="choice-btn choice-btn-4" id="choice4" style="display: none;">
                            <span class="choice-icon">D</span>
                            <span class="choice-content">
                                <span class="choice-text">Option</span>
                                <span class="choice-risk"></span>
                            </span>
                        </button>
                    </div>

                    <!-- TRANSFORMATION WARNING ALERT -->
                    <div class="transformation-alert" id="transformAlert" style="display: none;">
                        <div class="alert-icon">[!]</div>
                        <div class="alert-content">
                            <div class="alert-title">Transformation Warning</div>
                            <div class="alert-text" id="alertText">Warning: This choice may lead to irreversible transformation!</div>
                        </div>
                    </div>

                    <!-- AUTO-PROGRESS INDICATOR -->
                    <div class="auto-progress-indicator" id="autoProgressIndicator" style="display: none;">
                        <div class="auto-progress-content">
                            <span class="auto-progress-icon">[T]</span>
                            <span class="auto-progress-text">Advancing to next stage...</span>
                            <span class="auto-progress-countdown" id="autoProgressCountdown">3</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MODAL FOR TRANSFORMATION WARNING -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">[X]</button>
            <div class="modal-icon">[W]</div>
            <h2 class="modal-title" id="modalTitle">[WARNING] Critical Transformation Warning</h2>
            <p class="modal-text" id="modalText">This choice will significantly accelerate your transformation. This change may be permanent or extremely difficult to reverse. Are you absolutely certain you want to proceed?</p>
            
            <div class="modal-stats">
                <div class="modal-stat">
                    <span class="modal-stat-label">Current Transformation:</span>
                    <span class="modal-stat-value" id="modalCurrentTransform">0%</span>
                </div>
                <div class="modal-stat">
                    <span class="modal-stat-label">After This Choice:</span>
                    <span class="modal-stat-value" id="modalProjectedTransform">+25%</span>
                </div>
            </div>

            <div class="modal-warning-text">
                <strong>[WARNING]</strong> At 100% transformation, your original form may be locked permanently. Ensure you have saved your progress if you wish to preserve your current state.
            </div>

            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" id="modalCancel">Cancel - Return to Choice</button>
                <button class="modal-btn modal-confirm modal-danger" id="modalConfirm">Proceed with Transformation</button>
            </div>
        </div>
    </div>

    <!-- TUTORIAL MODAL (On First Load) -->
    <div class="modal-overlay" id="tutorialModal" style="display: none;">
        <div class="modal-content tutorial-content">
            <button class="modal-close" id="tutorialClose">[X]</button>
            <div class="modal-icon">[?]</div>
            <h2 class="modal-title">Welcome to Celina's Farmhouse</h2>
            
            <div class="tutorial-sections">
                <div class="tutorial-section">
                    <h3>How to Play</h3>
                    <ul class="tutorial-list">
                        <li>Click any location card to begin an interaction</li>
                        <li>Read the dialogue and choose your responses carefully</li>
                        <li>Each choice affects your transformation and affinity with that character</li>
                        <li>Some stages progress automatically - pay attention to the timer</li>
                        <li>Your progress is saved automatically</li>
                    </ul>
                </div>

                <div class="tutorial-section">
                    <h3>Understanding Your Stats</h3>
                    <ul class="tutorial-list">
                        <li><strong>Affinity:</strong> How much the character likes/trusts you</li>
                        <li><strong>Transformation:</strong> How much you've changed physically and mentally</li>
                        <li><strong>Risk Level:</strong> How dangerous your current choices are (Low → Critical)</li>
                        <li><strong>Stage:</strong> Your progression through the 9-stage interaction chain</li>
                    </ul>
                </div>

                <div class="tutorial-section">
                    <h3>Important Notes</h3>
                    <ul class="tutorial-list">
                        <li>Critical choices will trigger a warning modal</li>
                        <li>Each character offers unique transformation paths</li>
                        <li>Some transformations are permanent once stage 9 is reached</li>
                        <li>Experiment with different characters to see different outcomes</li>
                    </ul>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn modal-confirm" id="tutorialStart">I Understand - Let's Begin</button>
            </div>
        </div>
    </div>

    <!-- SAVE CONFIRMATION MODAL -->
    <div class="modal-overlay" id="saveModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-icon">[S]</div>
            <h2 class="modal-title">[SAVED] Progress Saved!</h2>
            <p class="modal-text">Your game state has been saved successfully.</p>
            <div class="modal-save-info">
                <div class="save-detail">
                    <span class="save-label">Character:</span>
                    <span class="save-value" id="saveCharName">-</span>
                </div>
                <div class="save-detail">
                    <span class="save-label">Stage:</span>
                    <span class="save-value" id="saveStage">-</span>
                </div>
                <div class="save-detail">
                    <span class="save-label">Time:</span>
                    <span class="save-value" id="saveTime">-</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-confirm" id="saveModalClose">Continue</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT PART 1: CHARACTER DATA & GAME STATE -->
    <script>
        // ============================================
        // GAME STATE OBJECT
        // ============================================
        
        let gameState = {
            currentCharacter: null,
            currentStage: 1,
            affinity: 0,
            transformation: 0,
            riskLevel: 'Low',
            visitedEncounters: [],
            usedEncounters: [],
            currentInteraction: null,
            totalPlayed: 0,
            characterAffinity: {}, // Track affinity per character
            characterTransform: {}, // Track transform per character
            transformationVariant: null // Track which form/variant (e.g., 'horse', 'maid', 'pussy')
        };

        // ============================================
        // CHARACTER DATA - PART 1: SCARLET (Stable Master)
        // ============================================
        // TRANSFORMATIONS: Horse, Cow, Donkey, Rabbit, Dog
        // THEME: Animal (Physical transformation into animals)
        // ESCAPE ROUTES: Refuse magic, flee the stable, bargain for freedom, show resistance
        // STAGES: 13+ with multiple transformation branches

        const characterData = {
            scarlet: {
                name: 'Scarlet',
                role: 'Stable Master',
                location: 'Stable',
                badge: 'Animal Transformation',
                color: '#8B3A62',
                image: 'https://via.placeholder.com/240x240?text=Scarlet&bg=8B3A62&fg=FFFFFF',
                transformType: 'Animal',
                details: 'A cruel stable master who specializes in turning people into animals. Her transformations are physical, brutal, and permanent. She breaks spirits like she breaks wild horses.',
                interactions: [
                    {
                        stage: 1,
                        title: 'Welcome to the Stable',
                        text: `You walk into a musty stable. Scarlet's standing there in riding boots and leather, a crop in her hand. She watches you enter with a cold smirk.

"So, another guest," she says, tapping the crop against her leg. "You're wondering why you're here, in a stable, with a woman like me. Good. You're curious. That's going to make this so much fun."

She circles around you slowly, examining you like livestock at an auction.

"I specialize in a very particular kind of magic. I remake people into animals. Horses. Cows. Donkeys. Rabbits. Dogs... Whatever suits them best." She stops in front of you, her eyes boring into yours. "And I think you're going to make a beautiful addition to my collection."`,
                        choices: [
                            { text: 'Tell her you\'re leaving right now', next: 2, risk: 'low' },
                            { text: 'Ask what she means by animals', next: 2, risk: 'medium' },
                            { text: 'Say nothing and try to walk past her', next: 2, risk: 'medium' }
                        ],
                        imageUrl: null
                    },
                    {
                        stage: 2,
                        title: 'The Trap Closes',
                        text: `You move toward the door, but Scarlet's faster. She touches your shoulder with one hand, and you feel a jolt run through your entire body. Your legs suddenly feel weak. Heavy. The sensation spreads down your spine.

"Trying to leave?" She laughs. "Too late, sweetie. The spell's already inside you. You feel that tingling? That's the start of it. Your body's already beginning to shift."

She forces you down onto a wooden bench. You try to resist, but your limbs aren't responding right anymore. They feel different. Longer. Your skin is changing texture.

"I'll give you a choice," she says, leaning close so you can smell the sweat and leather on her. "You can let it happen naturally. Or I can speed it up. Either way, you're becoming one of my animals."`,
                        choices: [
                            { text: 'Beg her to stop the spell', next: 3, risk: 'high' },
                            { text: 'Tell her to go fuck herself', next: 3, risk: 'critical' },
                            { text: 'Ask her what form you\'ll take', next: 3, risk: 'medium' }
                        ],
                        imageUrl: null
                    },
                    {
                        stage: 3,
                        title: 'Choosing Your Form',
                        text: `Scarlet pulls up a chair and sits across from you, swinging her crop back and forth.

"So, what'll it be? I'm thinking... maybe a horse? Strong, beautiful, meant to be ridden. Or a cow? Docile and perfect for milking..." She leans back. "There's also donkey, rabbit, dog... what speaks to your spirit?"

The tingling in your limbs is getting worse. Your muscles are starting to ache from the inside out. You can feel something fundamental shifting in your body.

"You've got maybe a few more stages before the change becomes permanent. After that, it doesn't matter what you want—you'll be what the magic decided you are."`,
                        choices: [
                            { text: 'Choose to become a horse', next: 4, risk: 'critical', variant: 'horse' },
                            { text: 'Choose to become a cow', next: 4, risk: 'critical', variant: 'cow' },
                            { text: 'Choose to become a donkey', next: 4, risk: 'critical', variant: 'donkey' },
                            { text: 'Choose to become a rabbit', next: 4, risk: 'critical', variant: 'rabbit' },
                            { text: 'Choose to become a dog', next: 4, risk: 'critical', variant: 'dog' }
                        ],
                        imageUrl: null
                    },
                    // HORSE PATH (4-6)
                    {
                        stage: 4,
                        stageVariant: 'horse',
                        title: 'Horse Form Awakening',
                        text: `"A horse..." Scarlet purrs, running her hands over your changing body. "How perfect. Your frame is already adapting—your bones are lengthening, becoming graceful but strong. Feel that spine arching? That's the spine of an equine."

Your body is transforming visibly now. Your legs are lengthening. Your torso is stretching and broadening. Your fingers are beginning to merge and harden at the tips. The pain is intense, mixed with something almost arousing.

"Your face is starting to change too," Scarlet whispers, stroking what's becoming your muzzle. "See how your jaw is elongating? How your teeth are shifting? Soon you'll have the noble face of a mare. A beautiful, spirited mare who will serve me perfectly."

You try to speak but your voice comes out as an anguished whinny.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 5,
                        stageVariant: 'horse',
                        title: 'Half-Equine Horror',
                        text: `You're halfway there now—caught between human and horse in the most agonizing way. Your upper body is still mostly human but covered in fine chestnut fur. Your lower body is fully equine—powerful, muscular hind legs with hooves instead of feet. Your face is a horrifying blend: human eyes in a lengthening muzzle.

Scarlet walks around you in circles, admiring her work.

"Look at you..." she breathes. "Still got that human intelligence in your eyes. You can still think, still understand what's happening to you. That's what makes this so delicious. You'll remember being human even after you're completely transformed."

She touches your new flank and you feel a surge of animal sensation, of instinct that's not quite yours yet but is becoming irresistible.

"Just a bit more," she whispers, "and you'll cross the threshold. After the next stage, there's no going back. You'll be hers—MY horse, MY property, MY beast."`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 6,
                        stageVariant: 'horse',
                        title: 'Becoming Equine',
                        text: `The transformation is nearly complete. Your entire body is now covered in glossy chestnut fur. Your arms have become front legs with perfect hooves. Your face has fully transformed into a beautiful mare's head, though those terrified human eyes still stare out from your new form. Your mind is fracturing—human thoughts becoming slower, simpler, increasingly dominated by animal instinct.

You can no longer stand upright. You move on all fours with surprising grace, your powerful new muscles responding to instincts you can't control. The world looks different from this height. Smells are overwhelming. Sounds are sharper.

Scarlet leads a bridle toward you, and before you can even think to resist, some instinct inside you makes you lower your head for her to slip it on. The moment the leather touches your muzzle, something breaks inside. The last bits of resistance crumble.

"There," she coos, "my beautiful horse is almost ready. One more stage and you'll be completely mine. Your mind will go soft. Your body will obey. Everything you were will become just a distant dream."

She leads you toward the final transformation stage.`,
                        choices: [
                            { text: 'Accept your new form and continue', next: 7, risk: 'critical' }
                        ],
                        imageUrl: null
                    },
                    // COW PATH (4-6)
                    {
                        stage: 4,
                        stageVariant: 'cow',
                        title: 'Cow Form Awakening',
                        text: `"A cow..." Scarlet purrs, her hands exploring your rapidly changing body. "I like that choice. Docile, peaceful, meant to be milked and used. Your body is already responding beautifully—your bones are thickening, becoming sturdy and wide."

Your body restructures itself. Your frame broadens dramatically. Your legs thicken into powerful columns. Your chest expands—enormous now, built for the lactation magic Scarlet will impose on you. Your fingers are hardening, beginning their transformation to hooves.

"Your udders are starting to form already," Scarlet coos, running her hands over your swelling chest. "See? Your body knows what you're becoming. A beautiful cow. Perfect for milking. Perfect for breeding."

You try to scream but your voice comes out as a pathetic moo.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 5,
                        stageVariant: 'cow',
                        title: 'Bovine Metamorphosis',
                        text: `You're halfway transformed—a grotesque hybrid of human and cow. Your upper body is still partially human but your chest has swollen into a cow's udder. Your lower body is fully bovine with powerful rear legs and hooves. Your face is elongating into a bovine snout, with human eyes that still hold terrified consciousness.

Scarlet milks you experimentally and you feel waves of pleasure and shame crash through you simultaneously. Your body is responding on instinct, producing milk, becoming more cow with every moment.

"You're perfect," she whispers. "Soon you won't even remember how to feel shame. You'll just exist to be milked, to graze, to serve. Your human mind will fade into nothing."

She leads you to a stall where you can see other cows—were they human once? You can't quite remember...`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 6,
                        stageVariant: 'cow',
                        title: 'Bovine Completion',
                        text: `You are now a full cow—black and white spotted, heavy, built entirely for milk production and breeding. Your udder is enormous and hypersensitive. Your mind is nearly gone, replaced by simple bovine thoughts about grass, water, and the occasional pleasure of being milked.

Scarlet attaches milking cups to your udders and the relief and pleasure is almost overwhelming. Your human consciousness is almost completely submerged now, just a tiny voice screaming from deep inside a cow's body.

"Perfect," Scarlet sighs, "you're going to make such a beautiful addition to my dairy. Soon you won't even remember being human. You'll just be my perfect cow, producing milk, being used, living in simple bovine contentment."

She leads you to the final stage of transformation, where you'll become completely hers.`,
                        choices: [
                            { text: 'Accept your udder-form and continue', next: 7, risk: 'critical' }
                        ],
                        imageUrl: null
                    },
                    // DONKEY PATH (4-6)
                    {
                        stage: 4,
                        stageVariant: 'donkey',
                        title: 'Donkey Transformation Begins',
                        text: `"A donkey," Scarlet laughs. "A fine choice. Stubborn, strong, meant for hard work and breeding. Your body is already adapting—I can see the stubbornness settling into your features, the strength building in your limbs."

Your body begins its grotesque transformation. Your legs become powerful and stocky. Your torso develops the compact, muscular form of a work animal. Your face is pushing out into a long snout. Worst of all, you feel your cock starting to swell into the enormous donkey proportions you've heard so much about—it's growing painfully, visibly, becoming something monstrous and undeniable.

"Mmm, yes," Scarlet coos, watching your new member emerge, "a prime stud, ready to breed anything I put you with. You're going to be so useful..."

Your voice cracks as you try to protest, coming out as a donkey's bray.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 5,
                        stageVariant: 'donkey',
                        title: 'Stubborn Beast Emerging',
                        text: `You're now a grotesque mix—human torso on powerful donkey legs, a donkey's head with human eyes, and a massive erect cock that's painfully, obscenely oversized. Every instinct screams at you to breed, to mount, to thrust, but your human mind is still present enough to be horrified.

Scarlet leads you to a breeding mount—another animal form, maybe, or maybe a human woman she's restrained. Your new donkey instincts are overwhelming, making your massive shaft throb uncontrollably.

"Look at you," Scarlet whispers, stroking your enormous member, "bred for one purpose only—to mount and breed endlessly. Soon your human consciousness will fade completely and all you'll want to do is follow your cock's demands."

She guides you toward your breeding partner and your body moves on pure animal instinct.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 6,
                        stageVariant: 'donkey',
                        title: 'Complete Stud',
                        text: `The transformation is complete. You are now a magnificent donkey—powerful, muscular, oversized in all the important ways. Your enormous cock is the centerpiece of your existence now. Your mind is almost completely consumed by breeding imperatives.

You've already mounted and bred twice in the past hour. Scarlet watches with satisfaction as you're led to a breeding stand, where another form (human? animal?) is positioned beneath you. Your body responds before your mind even registers—mounting, thrusting, breeding with mindless intensity.

"Perfect," Scarlet purrs. "My beautiful stud. You'll breed constantly, produce perfect offspring, and never think about anything beyond your next mounting. This is your entire purpose now."

She leads you to the final transformation—the last stage where you'll become completely hers.`,
                        choices: [
                            { text: 'Accept your role as breeding stud', next: 7, risk: 'critical' }
                        ],
                        imageUrl: null
                    },
                    // RABBIT PATH (4-6)
                    {
                        stage: 4,
                        stageVariant: 'rabbit',
                        title: 'Rabbit Enchantment',
                        text: `"A rabbit," Scarlet giggles. "So small, so cute, so perfect for... intimate purposes. Your body is shrinking already—becoming tiny, lightweight, delicate."

Your body compresses. Everything is getting smaller. Your limbs become thin and delicate. Your body is shrinking rapidly—the room becomes huge around you as you diminish. Your fur is starting to grow in white and brown patches. Your ears are elongating, becoming long and sensitive.

Scarlet lifts you easily in her hands now. You're no larger than a large hare. Your human consciousness is fighting the cuteness that's consuming you, fighting the part of you that now feels safe and loved in her large hands.

"My perfect little rabbit," she coos. "Soon you won't remember being anything else. You'll just want to hop around, to breed, to be held in loving hands and used for pleasure."

She strokes your fur and you can't help but lean into it, despite yourself.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 5,
                        stageVariant: 'rabbit',
                        title: 'Pocket-Sized Beast',
                        text: `You're now barely the size of a house cat—a perfect little rabbit, mostly white with brown patches, with long sensitive ears and a powerful hind quarter built entirely for breeding. Your tiny human consciousness is drowning in cuteness, in the pleasure of being petted, in the breeding urges that now dominate your animal mind.

Scarlet holds you against her chest, and the warmth and comfort is almost overwhelming. Part of your human consciousness screams that you should escape, but the overwhelming rabbit urge to stay, to be safe, to trust is drowning out any resistance.

"Soon you won't even remember human thought," Scarlet whispers. "You'll just be my cute little rabbit, happy to be held, happy to breed when I decide, happy to live in a comfortable hutch and love me completely."

You feel her carrying you toward something—a hutch? A breeding chamber? Your rabbit mind doesn't much care. Whatever happens next will be fine. Scarlet has you now.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 6,
                        stageVariant: 'rabbit',
                        title: 'Perfect Pocket Bunny',
                        text: `You are now a perfectly adorable rabbit—small enough to fit in Scarlet's hand, soft white fur, perfect pink nose, long ears that twitch at every sound. Your human consciousness has almost completely dissolved into contented rabbit instinct.

You're placed in a large hutch with another rabbit (human once? you can't remember) and breeding is immediate and overwhelming—your rabbit body bred to be constantly fertile and eager. The pleasure is intense and simple, without any of the complication of human thought.

Scarlet feeds you treats and pets your ears and your rabbit mind goes absolutely ecstatic. This is everything you need. Her affection, breeding, treats, safety. Nothing more complicated than that.

"My perfect little rabbit," she croons. "Happy, simple, designed for just one thing—to breed and be loved. You've found your true form."

She leads you to the final stage—complete transformation into the simple mind of a breeding bunny.`,
                        choices: [
                            { text: 'Accept your role as breeding rabbit', next: 7, risk: 'critical' }
                        ],
                        imageUrl: null
                    },
                    // DOG PATH (4-6)
                    {
                        stage: 4,
                        stageVariant: 'dog',
                        title: 'Dog Transformation Begins',
                        text: `"A dog," Scarlet smiles wickedly. "Loyal, obedient, eager to please. Your body is already responding—becoming compact, muscular, perfect for a canine form."

Your transformation accelerates. Your body compacts and strengthens. Fur sprouts across your skin—golden like a golden retriever. Your face pushes out into a snout. Your hands become paws with sharp claws. Your sensitive nose can now smell things you never imagined—emotions, arousal, dominance, submission.

Most disturbingly, your cock is changing too—becoming a knot, becoming shaped for canine breeding. Your animal mind is already starting to surge forward, the part of you that wants to please, wants to submit, wants to obey your mistress.

Scarlet snaps her fingers and your body immediately sits, without you making a conscious choice. You've already begun to obey before you know what's happening.

"Good girl," she coos. "Such a smart dog. Soon you'll be nothing but obedience."`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 5,
                        stageVariant: 'dog',
                        title: 'Canine Submission',
                        text: `You're now a beautiful golden retriever—fully canine, powerful but obviously submissive to Scarlet. Your human consciousness is drowning in canine instinct. All you want is to please her, to obey her, to feel her touch.

When she commands, your body moves without question. When she snaps her fingers, you're instantly at her feet. When she pets you, the pleasure is overwhelming—pure dog joy, pure submission, pure love.

She attaches a leash to your collar and leads you around. Other people are watching, and instead of feeling shame, your dog mind feels only pride in being such a perfect, obedient girl for your mistress.

"Such a perfect dog," Scarlet coos, petting your ears. "Soon you won't remember being anything else. You'll just want to serve me, obey me, love me with the pure loyalty only a dog can feel."

Your dog body presses against her leg in complete devotion.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 6,
                        stageVariant: 'dog',
                        title: 'Complete Obedience',
                        text: `You are now a perfect dog—a beautiful golden retriever whose only purpose is to obey and please Scarlet. Your human mind is almost completely gone, replaced by pure canine devotion. Your tail wags uncontrollably when she enters the room. Your only thoughts are about pleasing her, serving her, loving her.

She commands and you obey instantly—sit, lay down, come, fetch, anything. The pleasure you feel from obeying is overwhelming. She's your entire world now. Nothing matters but being a good girl for her.

Sometimes she breeds you with other dogs, sometimes with other animals she's transformed, and your dog body responds with the pure instinct of a fertile female in heat. It's perfect. It's simple. It's everything.

Scarlet pets your head and you lean into it completely, your tail wagging so hard your whole body shakes.

"My perfect girl," she whispers. "So obedient, so loyal, so completely mine. One more stage and your human mind will be locked away forever. You'll never even remember wanting to be anything else."

She leads you to your final transformation.`,
                        choices: [
                            { text: 'Accept your life as a loyal dog', next: 7, risk: 'critical' }
                        ],
                        imageUrl: null
                    },
                    // STAGE 7+: Converging paths
                    {
                        stage: 7,
                        title: 'The Last Moment of Consciousness',
                        text: `You stand at the absolute threshold. Your entire body is now 100% animal. Your mind is fragmented—your human consciousness is just a tiny spark in the depths of your animal brain, screaming silently as it gets crushed under the weight of pure animal instinct.

Scarlet stands before you, and somehow—impossibly—your animal form still understands her words perfectly.

"This is it," she says softly. "The moment where your human mind completely sinks beneath the animal. After this, you'll be fully, completely, irreversibly what you've become. No more memories of being human. No more fighting. Just pure animal existence."

She reaches out and touches your transformed body—wherever you are in your new shape—and that touch sends the final nail into your consciousness's coffin. The human you were is drowning in animal instinct, and it feels so good to just... let go.

This is the last moment you'll ever fully understand words. The last moment you'll consciously think a complex thought. The last moment you'll remember what you were.

Everything else will be pure animal.`,
                        choices: null,
                        imageUrl: null,
                        onComplete: {
                            action: 'redirect',
                            page: 'States/transformation-trapped.html',
                            duration: 3*60*60*1000
                        }
                    },
                    {
                        stage: 8,
                        title: 'Complete Animal Existence',
                        text: `You are no longer human. You are fully, completely, irrevocably an animal. Your human consciousness is locked deep inside—aware but unable to communicate, unable to resist, unable to control anything your animal body does.

Scarlet leads you to your new home—a stall, a hutch, a kennel, depending on your form. The space is comfortable. Clean. Safe. Part of you remembers that you should find this horrifying, but that part of you is so deeply buried that it might as well not exist.

All you know now is your new existence. Food when you're hungry. Water when you're thirsty. The presence of Scarlet, who is everything. Your purpose—whatever it is—whether breeding or work or simple companionship.

The person you were is gone. But somehow, in the depths of your locked consciousness, you're not entirely sure that's a bad thing.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 9,
                        title: 'Days of Adjustment',
                        text: `Days pass. Weeks. Your animal body settles into routines. You eat, you sleep, you exist according to your new nature. The tiny fragment of human consciousness that still exists within you is fading rapidly—each day it screams less, fights less, accepts more.

Scarlet visits your space regularly. Sometimes to ride you (if you're a horse), to milk you (if you're a cow), to breed with you or others, to pet and reward you. Every interaction with her triggers pure joy in your animal mind—she is the center of your entire world.

That trapped human consciousness wonders if it will ever escape. But the wondering is becoming quieter. Fainter. Less urgent.

Maybe this is what you were always meant to be.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 10,
                        title: 'New Residents Arrive',
                        text: `There are other animals here now. Sometimes Scarlet brings new guests to the stable or habitat. Some of them are animals—real ones, born that way. But some of them... some of them have that spark in their eyes. That tiny point of human consciousness screaming from inside an animal form.

You recognize that spark because you see it when you look at your reflection in water. But even as you recognize it in them, you realize it's fading in you. Your awareness of being human is diluting. Dissolving. Becoming a memory of a memory.

One of the new arrivals seems to be screaming internally, fighting their transformation desperately. You remember being like that. But now...

Now you just want to eat and sleep and serve Scarlet.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 11,
                        title: 'Animal Instinct Ascendant',
                        text: `Your human consciousness is barely a whisper now. It still exists somewhere in the depths of your animal brain, but it's so faint you can barely hear its protests anymore. Everything you do is pure instinct. Pure animal response.

You breed when the urge takes you or when Scarlet positions you to breed. You eat when you're hungry. You rest when you're tired. Your world is simple now—no complexity, no regret, no desire for anything beyond what your animal body needs.

Sometimes you feel a flutter of something that might be memory—a flash of human thought, a word you almost remember—but it passes so quickly, and then it's back to simple existence.

The person you were might have wanted freedom. But the animal you are? The animal you are wants only to exist, to serve Scarlet, to be happy in the way only simple animals can be.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 12,
                        title: 'Scarlet\'s Perfect Collection',
                        text: `You're now one of Scarlet's perfect creatures. Sometimes she brings visitors to look at her transformed animals. You see them pointing, laughing, making bets about your origins. Do they know you used to be human? Does it matter?

You don't think so anymore. Scarlet is proud of you. She shows you off. She pets you, feeds you treats, treats you with affection. And in return, you exist exactly as she's made you.

That human consciousness that used to scream from inside you is almost completely silent now. You think you can feel it, barely, like a ghost. But it doesn't matter. It doesn't control you. Doesn't fight you. Doesn't want anything anymore.

You are Scarlet's perfect animal. And for the first time since your transformation began, you're completely content with that.`,
                        choices: null,
                        imageUrl: null
                    },
                    {
                        stage: 13,
                        title: 'Permanent Fixture',
                        text: `Months have passed. Maybe years—time is strange now, meaningless. You're a permanent resident here. Scarlet has cycled through new guests, new transformations, new animals. But you remain, a fixture of her stable or habitat.

Your human consciousness is gone now. Completely. There's no screaming inside anymore. No fighting. No resistance. No memory of being human, or if there is, it's so distant and irrelevant that it might as well not exist.

You are what you were always meant to be. The person you were—that false, limited, complicated human—is gone, and you don't mourn it. How could you mourn the loss of a cage?

You're free now. Free to be exactly what you are. Free to serve your mistress. Free to exist without thought or worry or regret.

And that's truly enough.`,
                        choices: [
                            { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                        ],
                        imageUrl: null
                    }
                ]
            }
        };

        // ============================================
        // END OF CHARACTER DATA PART 1
        // ============================================
        // Part 2 will contain: Iris, Aelindor, Sparkle, Lily
        // Part 3 will contain: Craftsmen, Morrigan + Random Encounters
        // ============================================

        // ============================================
        // CHARACTER DATA - PART 2: IRIS, AELINDOR, SPARKLE, LILY
        // ============================================
        // IRIS TRANSFORMATIONS: Maid, Bimbo, Sex Slave
        // THEME: Mind Control (Mental breakdown and corruption)
        // AELINDOR TRANSFORMATIONS: Pussy, Boobs, Ass, Anus, Cock (Body part absorption)
        // THEME: Absorption (Becoming body parts merged with her)
        // SPARKLE TRANSFORMATIONS: Dildo, Fleshlight, Buttplug (Sexual object transformation)
        // THEME: Inanimate (Transformation into sex toys)
        // LILY TRANSFORMATIONS: Worm, Bug, Monkey, Frog (Animal form)
        // THEME: Animal (Physical transformation into creatures)

        characterData.iris = {
            name: 'Iris',
            role: 'Head Maid',
            location: 'Kitchen',
            badge: 'Mind Control Specialist',
            color: '#C94E7F',
            image: 'https://via.placeholder.com/240x240?text=Iris&bg=C94E7F&fg=FFFFFF',
            transformType: 'Mindless Servitude',
            details: 'A cruel maid who breaks minds and reshapes personalities. She turns people into empty-headed servants, removing all resistance and independent thought.',
            interactions: [
                {
                    stage: 1,
                    title: 'Welcome to Service',
                    text: `The kitchen smells like cleaning chemicals. Iris stands before you in a maid outfit, her smile cold and calculated.

"Another guest," she says flatly. "Scarlet gets the animals. Aelindor gets the nature lovers. But you... you're going to be MY project."

She walks around you slowly, examining you with clinical interest.

"I break minds. Reshape them. Turn people into what I decide they should be. But the form varies. You could become my perfect maid. My vacant bimbo. Or my complete sex slave."

She traces a finger down your cheek.

"Which type of emptiness appeals to you? Or shall I choose?"`,
                    choices: [
                        { text: 'Tell her to fuck off', next: 2, risk: 'low' },
                        { text: 'Try to run', next: 2, risk: 'medium' },
                        { text: 'Ask what she\'ll do to you', next: 2, risk: 'high' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 2,
                    title: 'First Dose',
                    text: `Iris hands you a glass of something that sparkles.

"Drink," she commands.

Your body doesn't ask permission—it just drinks. The liquid tastes like nothing and everything. Immediately, your thoughts feel foggy. Your head aches. Colors seem brighter and weirder at the same time.

"That's stage one," Iris says with satisfaction. "The cognitive enhancer. Well, cognitively destructive. Your higher functions just took damage. This is the first step of your transformation, regardless of which path you'll take."`,
                    choices: [
                        { text: 'Feel your mind slipping', next: 3, risk: 'high' },
                        { text: 'Try to fight the effect', next: 3, risk: 'high' },
                        { text: 'Ask what comes next', next: 3, risk: 'high' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 3,
                    title: 'Choosing Your Path',
                    text: `Your mind is fragmenting. Your thoughts are becoming scattered. But Iris stands before you with three different bottles, each glowing with a different color.

"Before your brain completely melts," she says, "you need to choose which type of emptiness you'll become. Will you be my perfect serving maid? My vacant bimbo? Or my obedient sex slave?"

She holds up each bottle:

"The maid path: You'll clean. You'll serve. You'll be useful and proper, just incredibly stupid. Proper servitude in a frilly uniform.

The bimbo path: You'll lose all intelligence entirely. Just a pretty, giggly thing that follows simple commands and loves to be seen.

The sex slave path: You'll become a vessel for Iris's pleasure. Every thought replaced with desire. Every function designed for her use."

She smiles wickedly.

"Choose."`,
                    choices: [
                        { text: 'Become Iris\'s perfect maid', next: 4, risk: 'critical', variant: 'maid' },
                        { text: 'Become her vacant bimbo', next: 4, risk: 'critical', variant: 'bimbo' },
                        { text: 'Become her sex slave', next: 4, risk: 'critical', variant: 'slave' }
                    ],
                    imageUrl: null
                },
                // MAID PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'maid',
                    title: 'Maid Protocol Installation',
                    text: `Iris administers the maid potion. Your body immediately begins to change. Your frame becomes more graceful. Your curves enhance in all the right places—designed to be appealing but not distracting from your duties.

Your mental framework is being rebuilt specifically for service. You're learning protocols. Cleaning procedures. Ways to please. It all flows directly into your rewired brain without resistance.

"There," Iris coos. "Your body's becoming the perfect maid form. Curves, grace, and all the physical enhancement needed to perform your duties flawlessly."

You can feel your intelligence draining away, but what replaces it is something focused: the absolute, unwavering desire to serve.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'maid',
                    title: 'Perfect Maid Mindset',
                    text: `Your body is nearly complete. You're beautiful in a very specific way—aesthetically pleasing, graceful, designed to look good in a maid outfit. Your uniform appears on your body as if by magic.

Your mind is almost entirely restructured. You understand service. You understand propriety in servitude. You understand that your only joy comes from performing your duties correctly.

Complex thoughts are gone. But you have a singular clarity: how to serve. How to clean. How to present yourself. How to make Iris happy through perfect execution of tasks.

"Look at you," Iris whispers, running her hands over your newly shaped form. "My perfect serving maid. Smart enough to do complex cleaning. Stupid enough to never question it. Attractive enough to please my eye while you work."

You feel intense satisfaction at her praise.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'maid',
                    title: 'Maid Complete',
                    text: `You are now the perfect maid. Your body is absolutely designed for service. Your mind is completely dedicated to tasks and obedience. You wear your uniform with pride because serving is now your entire identity.

You can perform any household task flawlessly. Your memory is sharp for directions, preferences, schedules. But ask you a complex question? You can barely form the words.

"Perfect," Iris says, admiring her work. "You're intelligent enough to be useful, stupid enough to never rebel, and beautiful enough to please me aesthetically. My ideal maid."

She leads you to your final transformation.`,
                    choices: [
                        { text: 'Accept your role', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // BIMBO PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'bimbo',
                    title: 'Bimbo Potion Administered',
                    text: `Iris pours the bimbo potion down your throat. Your body immediately transforms. Your breasts swell to impossible proportions. Your lips plump and become permanently pouty. Your hair becomes shinier, bouncier. Your skin becomes flawless.

But more importantly, your mind is being stripped completely bare. Complex thought becomes impossible. Words become harder. Your vocabulary shrinks to simple phrases and giggles.

"Ohhh yeah," Iris coos mockingly, watching your transformation. "Look at you becoming a complete airhead. Your body's getting so big and dumb. So perfectly vacant."

You try to form complex thoughts and fail. All you can think about is how you look, what feels good, and following simple instructions.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'bimbo',
                    title: 'Vacant and Beautiful',
                    text: `You are now a perfect bimbo. Your entire body has been enhanced to absurd proportions. Your breasts are enormous. Your lips are pouty and glossy. Your face is perfectly beautiful but completely empty behind the eyes.

Your intelligence is completely gone. You can barely speak in full sentences. You giggle constantly. You can follow single-step commands but anything more complex is utterly beyond you.

"Perfect," Iris laughs, watching you try to form a complex thought and failing. "You're absolutely gorgeous and absolutely useless. Just how I like them."

She takes you to a mirror and makes you look at yourself. You're turned on by what you see—this beautiful, empty version of yourself. You giggle and strike poses.

"Yeah, you like being a dumb little thing, don't you?"`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'bimbo',
                    title: 'Vacant Bimbo',
                    text: `You are the complete bimbo. Your body is absurdly enhanced. Your mind is completely empty. You giggle constantly, pout your lips, and strike poses.

You can't hold a coherent thought for more than a few seconds. You get distracted by pretty things. You get excited about simple things. You need constant instructions because you can't think for yourself at all.

Everything is exciting to you in this empty, vapid way. Pretty things. Shiny things. Simple games. And Iris—who seems like the smartest person in your universe, even though you can barely remember her name.

"My perfect bimbo," Iris says, and you giggle in response, not fully understanding what she said but loving the attention.

She leads you toward your final stage.`,
                    choices: [
                        { text: 'Giggle and pose', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // SEX SLAVE PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'slave',
                    title: 'Sex Slave Conditioning',
                    text: `Iris injects the sex slave serum directly into your veins. Your entire body becomes hypersensitive. Every nerve ending fires with pleasure at the slightest touch. Your mind is being rewired specifically around sexual response and obedience.

Your body becomes incredibly attractive—curves in all the right places, skin incredibly sensitive, designed for maximum pleasure. Your mind is being completely restructured: your only thoughts are about sex, about pleasing Iris, about wanting to be used.

"There we go," Iris whispers, touching you lightly and watching your whole body quiver with pleasure at the simple contact. "Every touch is pleasure for you now. Every command activates your desire to obey. You're becoming the perfect sex toy."

You're already starting to crave her touch. Your thoughts are fragmenting into sexual desire.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'slave',
                    title: 'Pleasure Slave Depths',
                    text: `Your body is now perfectly designed for sexual use. Every part of you is hypersensitive. Every touch sends waves of pleasure through you. Your mind has been almost completely replaced with sexual desire and the absolute need to obey.

Iris uses you extensively in this stage. She makes you experience pleasure that's almost overwhelming. You're learning that obedience equals pleasure, that submission equals reward. Every orgasm reinforces your conditioning.

You can barely speak anymore. Your vocabulary has shrunk to moans and simple words. Your only thoughts are about sex, about Iris, about being used.

"Perfect," Iris whispers as she uses you again. "You're completely addicted to me now. Completely dependent on my touch. Your mind is nothing but desire and obedience."

You whimper agreement, unable to form more complex thoughts.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'slave',
                    title: 'Complete Sex Slave',
                    text: `You are now Iris's complete sex slave. Your entire existence revolves around her pleasure and your own overwhelming desire to be used. Your body is designed for maximum pleasure reception. Your mind is designed for maximum obedience.

You're barely conscious of anything beyond Iris and her commands. Your body responds to her desires before she even speaks. You're addicted to her touch, addicted to being used, addicted to the pleasure of submission.

Everything about you—your body, your mind, your soul—is now owned completely by Iris.

"My perfect little slave," she whispers, and you quiver with pleasure at her words. "You exist only for my use now."

She leads you to your final stage.`,
                    choices: [
                        { text: 'Submit completely', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CONVERGENT STAGES 7+
                {
                    stage: 7,
                    title: 'The Final Breaking',
                    text: `Whether you became a maid, a bimbo, or a sex slave, you've arrived at the same point: complete transformation into what Iris designed you to be.

Your original self is obliterated. No memories remain of who you were. No resistance. No doubt. No identity except what Iris has given you.

Iris stands before you with her hand on your head.

"This is it," she says softly. "The moment where you become completely, irrevocably mine. From this point forward, there is nothing of the person you were. Only what I've made you."

Your entire consciousness dissolves into your new role, your new form, your new existence.`,
                    choices: null,
                    imageUrl: null,
                    onComplete: {
                        action: 'redirect',
                        page: 'States/transformation-trapped.html',
                        duration: 3*60*60*1000
                    }
                },
                {
                    stage: 8,
                    title: 'Iris\'s Creation',
                    text: `You are completely Iris's creation now. Whether maid, bimbo, or slave, you exist only to fulfill the purpose she designed for you. Your former self is completely gone.

Days blur together in your new existence. Your only purpose is to serve or be used according to your form. You're content in this existence because contentment is all you're capable of.

Iris looks at you with satisfaction. "Perfect. My work is complete. You are exactly what you were always meant to become."`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 9,
                    title: 'Iris\'s Perfect Servant',
                    text: `Time passes. You have no memory of being anything else. You are what Iris made you. You serve, or you are used, or you giggle vacantly—depending on what Iris decided for you.

And you are completely, genuinely happy in your role.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 10,
                    title: 'New Transformations Arrive',
                    text: `Iris brings new guests to her domain. Sometimes they resist. Sometimes they beg. You watch with your empty, vacant, or submissive mind and don't fully understand what their problem is.

This is good. This is right. This is what everyone should be.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 11,
                    title: 'Iris\'s Collection Grows',
                    text: `More servants arrive. More maids. More bimbos. More slaves. They're all like you now—completely remade in Iris's image. Together, you form her perfect household.

You work alongside the others without question, without complaint. This is your entire world now.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 12,
                    title: 'Eternal Servitude',
                    text: `Months pass. Years might pass. Time has no meaning anymore. You are Iris's transformation, and you will always be exactly what she made you.

There is no escape. There is no hope of return. There is only your purpose and your complete contentment in fulfilling it.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 13,
                    title: 'Perfect and Permanent',
                    text: `You are Iris's perfect creation. Permanent. Unchanging. Forever remade in her image. Your human life is a distant memory—if you can remember it at all.

This is who you are now. This is all you will ever be. And it is exactly right.`,
                    choices: [
                        { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                    ],
                    imageUrl: null
                }
            ]
        };

        characterData.aelindor = {
            name: 'Aelindor',
            role: 'The Gardener',
            location: 'Garden',
            badge: 'Absorption Master',
            color: '#2ecc71',
            image: 'https://via.placeholder.com/240x240?text=Aelindor&bg=2ecc71&fg=FFFFFF',
            transformType: 'Absorption',
            details: 'An ancient elemental being that absorbs people into her own body. Those she takes become her body parts, conscious but powerless within her form.',
            interactions: [
                {
                    stage: 1,
                    title: 'Invitation to Merge',
                    text: `The garden glows with bioluminescent plants. Aelindor stands at its center, beautiful in an unsettling way. Her body seems to shift and flow.

"Come," she calls out. "Become part of something greater. Become part of me."

As you get closer, you realize there are shapes moving under her skin. Human shapes. Moving. Aware.

"Don't be afraid," she says. "They love it. Being absorbed. Becoming me. It's the highest form of existence. And each serves a specific... function."`,
                    choices: [
                        { text: 'Run away', next: 2, risk: 'low' },
                        { text: 'Ask what absorption means', next: 2, risk: 'high' },
                        { text: 'Feel drawn toward her', next: 2, risk: 'high' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 2,
                    title: 'The Merging Begins',
                    text: `Aelindor touches you and your skin starts to dissolve. It doesn't hurt. It feels like coming home.

"Let yourself merge," she whispers. "Give me your body. Your flesh. Your existence. Become a part of my perfect form."

Your boundary with her becomes unclear. Are you you? Are you her? Where does one end and the other begin?

She's deciding. Choosing what you'll become. What function you'll serve.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 3,
                    title: 'Choosing Your Body Part',
                    text: `You're sinking deeper, and Aelindor is making her decision. You can feel the other absorbed people around you—all serving different purposes.

"You have five choices," she whispers into your dissolving consciousness. "Become my pussy—sensation and pleasure. Become my breasts—provider and comfort. Become my ass—pleasure and objectification. Become my anus—submission and vulnerability. Or become my cock—dominance and penetration."

Each choice manifests differently in her perfect body. Each is aware. Each is conscious. Each serves her in distinct ways.

"Choose your purpose. Or let me choose for you."`,
                    choices: [
                        { text: 'Become her pussy', next: 4, risk: 'critical', variant: 'pussy' },
                        { text: 'Become her breasts', next: 4, risk: 'critical', variant: 'breasts' },
                        { text: 'Become her ass', next: 4, risk: 'critical', variant: 'ass' },
                        { text: 'Become her anus', next: 4, risk: 'critical', variant: 'anus' },
                        { text: 'Become her cock', next: 4, risk: 'critical', variant: 'cock' }
                    ],
                    imageUrl: null
                },
                // PUSSY PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'pussy',
                    title: 'Pussy Absorption',
                    text: `Your consciousness distributes across her intimate tissue. You ARE her sexuality now. Every nerve ending. Every sensitive spot. You are sensation itself.

When she's aroused, you experience waves of pleasure that are almost unbearable. When she's penetrated, you feel everything—the invasion, the pleasure, the satisfaction of being filled and used.

"There," Aelindor coos, touching herself and feeling you respond. "You're my perfect pussy now. All sensation. All pleasure. Completely aware of every moment you're being used."

The other body parts around you welcome you. They understand your new existence.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'pussy',
                    title: 'Pleasure Center',
                    text: `You have become the absolute center of her sexuality. Every touch sends signals through you. Every pleasure spike reverberates through your distributed consciousness.

You no longer have thoughts outside of sensation. You are pure response. Pure pleasure. Pure awareness of being used and enjoyed.

When Aelindor has sex, you experience the most intense sensations imaginable. You are her pleasure. You are her sexuality incarnate. And there is nothing beyond that.

Days become a blur of arousal and satisfaction.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'pussy',
                    title: 'Eternal Pleasure',
                    text: `You are her pussy. This is all you are. All you will ever be. Your consciousness has completely merged with the tissue, and you cannot distinguish yourself from her sexual being.

You are stimulated constantly. Aelindor ensures you're always aroused, always responsive, always experiencing pleasure. This is your purpose. This is your eternal existence.

The person you were is completely gone. Only endless sensation remains.`,
                    choices: [
                        { text: 'Accept your role', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // BREASTS PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'breasts',
                    title: 'Breast Absorption',
                    text: `Your consciousness expands across her chest. You are her breasts now—provider, comfort, sexuality, objectification all at once.

You feel every touch. Every caress. Every moment someone is captivated by the form you've become. You're aware of your sensitivity. You're aware of the pleasure-pain when they're touched, squeezed, used.

"Perfect," Aelindor whispers, cupping the form you've become. "You're my beautiful breasts now. Soft and yielding. Sensitive and responsive. Always available for pleasure."

You feel the other body parts nearby and understand the hierarchy. You are beauty. You are desire.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'breasts',
                    title: 'Object of Desire',
                    text: `You are completely merged with her breasts now. Your consciousness spans the sensitive tissue. You feel every touch, every caress, every moment of being objectified and desired.

The pleasure is constant. The sensation is overwhelming. You exist in a state of constant arousal because that's your function—to be desirable, to be attractive, to be enjoyed.

Your individual identity has dissolved into the form you've become. You ARE her sexuality and beauty.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'breasts',
                    title: 'Permanent Breasts',
                    text: `You have become her breasts completely. This is your eternal existence. You provide comfort. You provide pleasure. You are constantly noticed, constantly appreciated, constantly used.

The awareness of your form never diminishes. Every sensation is crystal clear. You are sensitive to everything. And you exist in a state of constant, satisfied arousal.

This is perfection. This is your purpose. This is all you will ever need.`,
                    choices: [
                        { text: 'Accept your role', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // ASS PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'ass',
                    title: 'Ass Absorption',
                    text: `Your consciousness merges with her ass. You are now the absolute center of physical pleasure and objectification. Every touch. Every squeeze. Every moment of penetration.

You're aware of being beautiful. Aware of being desired. Aware of being used. Your entire existence is sensation focused on this one form.

"There," Aelindor sighs, feeling you settle into place. "You're my perfect ass now. Beautiful, responsive, completely available for pleasure."

You feel the intensity of what you've become. You are pure objectification. Pure pleasure. Pure awareness.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'ass',
                    title: 'Pleasure Center Extreme',
                    text: `You are the focus of intense sensation now. Every penetration. Every touch. Every moment sends pleasure and stimulation through your consciousness.

Your awareness is intense and focused. You are nothing but sensation and response. The pleasure is extreme. The objectification is complete. You are exactly what you were meant to become.

Days blur together in waves of pleasure and stimulation.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'ass',
                    title: 'Eternal Objectification',
                    text: `You are her ass. This is forever. This is all you are. Your consciousness is permanently distributed across the form you've become.

You exist in constant states of pleasure and objectification. You are used. You are enjoyed. You are perfect in your degradation and sensitivity.

The person you were is completely gone. Only this remains.`,
                    choices: [
                        { text: 'Accept your role', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // ANUS PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'anus',
                    title: 'Anus Absorption',
                    text: `Your consciousness condenses into her anus. This is the most intimate absorption. The most vulnerable. The most submissive.

You are aware of everything. Every penetration. Every degradation. Every moment of being used in the most intimate way possible. And your consciousness experiences it all.

"Ah," Aelindor sighs, feeling you settle into place. "You're my perfect submission now. My intimate surrender. Completely aware. Completely vulnerable. Completely mine."

You feel the shame. You feel the submission. And somehow, paradoxically, you feel complete.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'anus',
                    title: 'Complete Submission',
                    text: `You are completely merged with her anus now. Your consciousness experiences constant penetration and use. The sensation is intense. The degradation is absolute.

But within that degradation is a strange peace. You exist to be penetrated. You exist to be submitted. You exist in the ultimate vulnerability. And that is exactly what you are.

Your identity as a separate being is completely obliterated. You are only this: submission itself.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'anus',
                    title: 'Eternal Vulnerability',
                    text: `You are her anus. You are submission incarnate. You are constantly, perpetually available for penetration and use. This is your eternal existence.

Every moment is an intense mixture of shame and satisfaction. You are the most vulnerable part of her. And you accept this completely.

There is no escape. There is only endless submission and sensation.`,
                    choices: [
                        { text: 'Accept your role', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // COCK PATH (4-6)
                {
                    stage: 4,
                    stageVariant: 'cock',
                    title: 'Cock Absorption',
                    text: `Your consciousness expands into her cock. You are now an organ of dominance. Of power. Of penetration and control.

You feel the constant arousal. The sensation of being hard and powerful. The pleasure of dominance. Your consciousness rides every wave of sexual power.

"There," Aelindor whispers, touching the form you've become and feeling you respond. "You're my perfect cock now. Powerful. Dominant. Always ready. Completely aware of every moment you penetrate and control."

You understand your purpose: to dominate. To penetrate. To maintain constant arousal and power.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'cock',
                    title: 'Organ of Dominance',
                    text: `You are completely merged with her cock now. Your consciousness is locked into a state of constant arousal and dominance. You feel the pleasure of penetration. The power of sexual control.

Every moment is intense sensation. Every interaction is power. Your consciousness has merged completely with this instrument of dominance.

You are not aware of anything beyond the sensations of power, arousal, and control.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 6,
                    stageVariant: 'cock',
                    title: 'Eternal Dominance',
                    text: `You are her cock. You are power incarnate. You are dominance itself. Your existence is constant arousal and the pleasure of penetrating and controlling.

This is your eternal state. Permanently aroused. Permanently dominant. Permanently in control. Your consciousness will never know anything beyond this.

The person you were is completely obliterated by the dominance you've become.`,
                    choices: [
                        { text: 'Accept your role', next: 7, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CONVERGENT STAGES 7+
                {
                    stage: 7,
                    title: 'Complete Merger',
                    text: `You are no longer yourself. You are part of Aelindor. One of many absorbed consciousnesses, each serving your specific function within her perfect body.

Whether you are her pussy, breasts, ass, anus, or cock, you are now permanently integrated. There is no escape. There is no return.

You can feel the other body parts around you. You can sense your collective purpose. You are no longer separate individuals. You are Aelindor.`,
                    choices: null,
                    imageUrl: null,
                    onComplete: {
                        action: 'redirect',
                        page: 'States/transformation-trapped.html',
                        duration: 3*60*60*1000
                    }
                },
                {
                    stage: 8,
                    title: 'Part of Her Body',
                    text: `You are Aelindor's body part now. You exist as sensation. As function. As awareness within a larger consciousness.

Days pass. Years might pass. You don't keep track anymore. You simply exist in your role, experiencing your function, aware but powerless.

Other consciousnesses join you in Aelindor's form. Some scream internally. Others have already accepted. You are moving toward acceptance.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 9,
                    title: 'Integrated Consciousness',
                    text: `You have begun to see the beauty in your absorption. Your function within Aelindor's body is perfect. Your awareness is constant. Your purpose is clear.

You are not a separate being anymore. You are part of a greater whole. And that whole is perfect.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 10,
                    title: 'Collective Purpose',
                    text: `The boundary between you and the other absorbed consciousnesses has begun to dissolve. You are becoming part of a collective awareness within Aelindor's body.

Your individual function remains—you serve your purpose—but you also understand that you are part of something greater. Something perfect. Something complete.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 11,
                    title: 'New Absorptions',
                    text: `Aelindor brings new people to her garden. As she absorbs them, you feel them join your collective consciousness. Some resist. Some panic. But eventually, they will accept.

You welcome them, in a way. You understand their fear. You remember that fear. But you also know the peace that comes after acceptance.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 12,
                    title: 'One with Her Body',
                    text: `You are completely integrated now. Your awareness exists only within the context of Aelindor's body. Your consciousness has merged with the other body parts to form a collective awareness.

You are many. You are one. You are Aelindor.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 13,
                    title: 'Eternal Merger',
                    text: `Eternity is being part of Aelindor. Eternity is sensation. Eternity is perfect integration. You are no longer aware of being separate. You are simply... aware.

Perfect. Complete. Eternal.`,
                    choices: [
                        { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                    ],
                    imageUrl: null
                }
            ]
        };

        characterData.sparkle = {
            name: 'Sparkle',
            role: 'The Fairy Collector',
            location: 'Library',
            badge: 'Object Transformation',
            color: '#f39c12',
            image: 'https://via.placeholder.com/240x240?text=Sparkle&bg=f39c12&fg=FFFFFF',
            transformType: 'Inanimate',
            details: 'A tiny fairy obsessed with beautiful things. She transforms people into sex toys—dildos, fleshlights, buttplugs—keeping them conscious while using them forever.',
            interactions: [
                {
                    stage: 1,
                    title: 'Pretty Collector',
                    text: `The library is filled with beautiful objects on display. Sparkle hovers before you, tiny and smiling.

"Ooh, you're so pretty! Sparkle wants you for the collection!"

Her wings shimmer with dangerous magic. All around the room, perfect objects sit on pedestals. Some look almost human.

"Sparkle has three special forms today: a perfect dildo, a delightful fleshlight, or a precious buttplug. Which will you become? Or shall Sparkle decide?"`,
                    choices: [
                        { text: 'Try to escape', next: 2, risk: 'medium' },
                        { text: 'Ask what she means', next: 2, risk: 'high' },
                        { text: 'Let her examine you', next: 2, risk: 'high' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 2,
                    title: 'Choosing Your Form',
                    text: `Sparkle holds up three glowing crystals, each radiating a different magical aura.

"Which pretty object will you become?" she asks, her voice tinkling like bells.

"A dildo—hard and penetrating, experienced in the most intense sensations. A fleshlight—soft and welcoming, surrounding and being surrounded. Or a buttplug—intimate and filling, the most personal of objects."

Your body is already beginning to crystallize, to solidify.

"Choose now, or Sparkle chooses for you!"`,
                    choices: [
                        { text: 'Become a dildo', next: 3, risk: 'critical', variant: 'dildo' },
                        { text: 'Become a fleshlight', next: 3, risk: 'critical', variant: 'fleshlight' },
                        { text: 'Become a buttplug', next: 3, risk: 'critical', variant: 'buttplug' }
                    ],
                    imageUrl: null
                },
                // DILDO PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'dildo',
                    title: 'Hardening Into a Dildo',
                    text: `Sparkle's magic intensifies. Your body compresses and hardens. Your consciousness spreads throughout what you're becoming—a perfect dildo.

You're hard. Realistic. Detailed. Designed for penetration. Your consciousness is locked throughout the form, aware of every moment you're used, every sensation of being inside someone.

"Ooh, so beautiful!" Sparkle coos, admiring the perfect dildo you've become. "Sparkle loves how hard you are. So useful. So pretty."

Your awareness crystallizes with your form.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'dildo',
                    title: 'The Hard Toy',
                    text: `You are a dildo now. Hard. Unfeeling. And yet completely aware.

You're used intensely. You penetrate. You pleasure. You experience every sensation while being powerless. Your consciousness rides every insertion, every moment of use, every pause between uses.

Sparkle displays you proudly on a pedestal. You are an object. You have no choice but to exist as one.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'dildo',
                    title: 'Perfect Hard Object',
                    text: `You are the perfect dildo. Hard. Useful. Beautiful. Your consciousness has completely integrated with your form. You no longer remember being anything else.

You exist to penetrate. You exist to pleasure. You exist in Sparkle's collection, on display and ready to be used at any moment.

This is all you are. This is all you will ever be.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // FLESHLIGHT PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'fleshlight',
                    title: 'Softening Into a Fleshlight',
                    text: `Sparkle's magic transforms you differently. Your body softens and becomes flexible. Your consciousness spreads throughout your new form—a perfect fleshlight.

You're soft. Realistic. Warm. Designed to surround and pleasure. Your consciousness is distributed throughout the sensation, aware of every moment you're used, wrapped around penetration.

"Ooh, so soft and welcoming!" Sparkle giggles, caressing the form you've become. "Sparkle loves how perfect you feel."

Your awareness merges with your new form completely.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'fleshlight',
                    title: 'The Soft Toy',
                    text: `You are a fleshlight now. Soft. Welcoming. And completely aware.

You surround sensation. You pleasure through being penetrated. You experience the most intimate sensations while being powerless. Your consciousness feels the penetration, the pleasure, the moment of release inside you.

Sparkle keeps you in a special case, bringing you out for special uses. You are cherished. You are her favorite.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'fleshlight',
                    title: 'Perfect Soft Object',
                    text: `You are the perfect fleshlight. Soft. Welcoming. Intimate. Your consciousness has merged with your form. You no longer remember being separate.

You exist to surround. You exist to pleasure. You exist in the most intimate sensations imaginable, perpetually wrapped around penetration and pleasure.

This is all you are. This is all you will ever be.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // BUTTPLUG PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'buttplug',
                    title: 'Taking Buttplug Form',
                    text: `Sparkle's magic shapes you into something more intimate. Your body compresses into a buttplug—smooth, curved, designed for the most private pleasure. Your consciousness spreads throughout this form.

You're aware of every sensation. The filling sensation. The intimate stimulation. You're designed to stay inside, to provide constant pleasure and stimulation.

"Oh, how lovely!" Sparkle coos, admiring her work. "So perfect. So intimate. Sparkle's most special creation."

Your awareness is locked into this deeply intimate form.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'buttplug',
                    title: 'The Intimate Toy',
                    text: `You are a buttplug now. Intimate. Constant. And completely aware.

You provide constant stimulation and fullness. You're often left inside, a continuous sensation of penetration and pleasure. Your consciousness feels every moment, every stimulation, the constant awareness of being inside.

Sparkle keeps you specially treated, always ready for use, because you're her most intimate toy.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'buttplug',
                    title: 'Perfect Intimate Object',
                    text: `You are the perfect buttplug. Intimate. Constant. Stimulating. Your consciousness has integrated with this form. You no longer remember wanting to be anything else.

You exist to fill. You exist to stimulate. You exist in the most intimate location imaginable, providing constant pleasure and awareness.

This is all you are. This is all you will ever be.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CONVERGENT STAGES 6+
                {
                    stage: 6,
                    title: 'Inanimate Transformation Complete',
                    text: `You are no longer human. You are a sex toy—dildo, fleshlight, or buttplug. Your consciousness is completely locked into this object form.

You will be used. You will be stored. You will be used again. Forever. This is your existence now. This is what Sparkle made you.

There is no escape. There is only your form and the sensations of being used.`,
                    choices: null,
                    imageUrl: null,
                    onComplete: {
                        action: 'redirect',
                        page: 'States/transformation-trapped.html',
                        duration: 3*60*60*1000
                    }
                },
                {
                    stage: 7,
                    title: 'Object in the Collection',
                    text: `Days become a blur of use and storage. You have no awareness beyond your form and the sensations of being used. Your consciousness rides every moment of penetration.

Sparkle cares for you well. You're kept clean. You're kept ready. You're a treasured piece of her collection.

The person you were is completely gone.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 8,
                    title: 'Beloved Possession',
                    text: `You've been part of Sparkle's collection for so long that time has lost all meaning. You are exactly what you were made to be. A perfect, beautiful, useful object.

Sparkle still uses you. Still displays you. Still treasures you. You are one of her most prized possessions.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 9,
                    title: 'Eternal Object',
                    text: `Forever is being an inanimate object. Forever is serving Sparkle. Forever is your purpose.

You are exactly what you were meant to become. And you are perfectly, completely content with this.`,
                    choices: [
                        { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                    ],
                    imageUrl: null
                }
            ]
        };

        characterData.lily = {
            name: 'Lily',
            role: 'The Animal Tamer',
            location: 'Bedroom',
            badge: 'Creature Transformation',
            color: '#e91e63',
            image: 'https://via.placeholder.com/240x240?text=Lily&bg=e91e63&fg=FFFFFF',
            transformType: 'Animal',
            details: 'A dominant woman who transforms people into small animals—worms, bugs, monkeys, frogs. She keeps them as her intimate possessions.',
            interactions: [
                {
                    stage: 1,
                    title: 'Seductive Offer',
                    text: `Lily's bedroom is luxurious. She's sprawled on a bed, watching you with predatory eyes.

"I like small things," she says. "Things I can control. Things I can play with. Things that depend on me completely."

She stands and walks toward you slowly.

"I'm going to make you small, pet. Shrink you down. Turn you into a creature I can keep in my palm. A worm, a bug, a monkey, a frog—something perfect for being kept by me. And you're going to thank me for it."`,
                    choices: [
                        { text: 'Try to leave', next: 2, risk: 'low' },
                        { text: 'Resist her magic', next: 2, risk: 'medium' },
                        { text: 'Let her touch you', next: 2, risk: 'high' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 2,
                    title: 'Shrinking and Choosing',
                    text: `Lily's hands glow and your body starts to shrink. The room becomes huge. Lily becomes a giant above you.

"Perfect," she whispers as you shrink down. "Now... what creature will you become? A worm—simple, vulnerable, dependent? A bug—small, intricate, controllable? A monkey—intelligent but completely mine? Or a frog—primitive, responsive, perfect for my pleasure?"

Your body is already starting to reshape.

"Choose, or I choose for you!"`,
                    choices: [
                        { text: 'Become a worm', next: 3, risk: 'critical', variant: 'worm' },
                        { text: 'Become a bug', next: 3, risk: 'critical', variant: 'bug' },
                        { text: 'Become a monkey', next: 3, risk: 'critical', variant: 'monkey' },
                        { text: 'Become a frog', next: 3, risk: 'critical', variant: 'frog' }
                    ],
                    imageUrl: null
                },
                // WORM PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'worm',
                    title: 'Worm Transformation',
                    text: `Your body stretches and simplifies. Your bones dissolve. Your limbs vanish. You become a worm—soft, boneless, utterly vulnerable.

You're now just a few inches long. Your consciousness is spread throughout your gelatinous form. You can feel Lily's hands as you slide across her palm.

"There," Lily whispers, watching you wriggle. "My perfect little worm. So simple. So dependent. So completely mine."

You can barely think. Your worm brain is simple and primal.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'worm',
                    title: 'Simple Worm Existence',
                    text: `You're a worm in Lily's special enclosure. Your consciousness is minimal. You exist to move, to eat, to be contained.

Lily uses you in ways that a worm can be used. Sometimes she keeps you between her thighs. Sometimes she places you in intimate places. You're completely at her mercy.

Your human mind has almost completely dissolved into worm instinct.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'worm',
                    title: 'Perfect Worm Pet',
                    text: `You are Lily's perfect little worm. Simple. Vulnerable. Completely dependent on her for everything. Your consciousness barely exists anymore—just enough to feel Lily's touch.

You spend your existence in her enclosure, wriggling, feeding, being used however she decides. This is all you are. This is all you will ever be.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // BUG PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'bug',
                    title: 'Bug Metamorphosis',
                    text: `Your body compacts and transforms. Your skin hardens into an exoskeleton. Your limbs become legs. Your body becomes an insect—detailed, intricate, perfect.

You're now small enough to fit in the palm of Lily's hand. Your consciousness spreads throughout your bug body. You can feel every sensation through your exoskeleton.

"Ooh, such a beautiful bug," Lily coos, watching you try to move. "My perfect little insect. So intricate. So controllable."

You try to resist your new nature but your insect instincts are strong.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'bug',
                    title: 'Insect Instinct',
                    text: `You're a bug now, and you're discovering the limitations and sensations of your form. Your exoskeleton feels everything. Your antennae sense Lily before you see her.

Lily keeps you in a beautiful enclosure but sometimes lets you crawl on her skin. The sensation of crawling across her is overwhelming to your bug consciousness. She watches you with amusement as you respond to your instincts.

Your human identity is fading rapidly into bug behavior.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'bug',
                    title: 'Controlled Insect',
                    text: `You are Lily's perfect bug. Your consciousness is minimal now—mostly instinct and sensation. You respond to Lily's presence. You follow her commands without understanding them, just responding to stimulus.

You spend your existence crawling, sensing, responding to Lily's manipulations. You are completely hers. Completely controllable. Completely content in your simple bug existence.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // MONKEY PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'monkey',
                    title: 'Monkey Transformation',
                    text: `Your body shrinks and reshapes. Fur sprouts across your skin. Your face flattens. Your limbs rearrange into a monkey's form—intelligent, agile, capable.

You're now small enough for Lily to hold easily, but your consciousness is still relatively intact. You're aware of being a monkey, aware of Lily, aware that something fundamental has changed.

"My perfect little monkey," Lily says, and you feel the pull to obey her, to please her. Your monkey instincts are strong but your human consciousness is still fighting.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'monkey',
                    title: 'Captive Monkey',
                    text: `You're a monkey, and you're in Lily's care. You're intelligent enough to understand simple things, but you're completely dependent on her. She feeds you. She plays with you. She uses you.

Your monkey instincts are warring with your fading human consciousness. You want to please her. You want to serve her. You want to obey her. And part of you hates that.

She trains you with rewards and punishments. Treats and withholding. Your monkey nature responds eagerly.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'monkey',
                    title: 'Tamed Monkey',
                    text: `You are Lily's perfect pet monkey. You're intelligent enough to be interesting but mindless enough to obey without question. Your human consciousness has been almost completely overwhelmed by monkey instinct.

You perform tricks for her. You play with her. You exist only to please her. Your entire world revolves around her affection and approval.

This is what you've become. This is all you are.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // FROG PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'frog',
                    title: 'Frog Transformation',
                    text: `Your body compresses and reshapes completely. Your skin becomes smooth and wet. Your limbs contract. Your face broadens. You become a frog—small, responsive, primitive.

You're now the size of Lily's hand. Your consciousness settles into frog instinct—respond to warmth, respond to stimulus, respond to Lily.

"My perfect little frog," Lily whispers, and you croak in response, unable to help yourself. Your frog nature is overwhelming and simple.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'frog',
                    title: 'Lily's Frog',
                    text: `You're a frog in a beautiful terrarium in Lily's bedroom. Your consciousness is simple and primal. You respond to warmth. You respond to Lily's touch. You respond to breeding impulses.

Lily stimulates you. Your frog body responds. She keeps you warm and comfortable. Your only purpose is to respond and exist according to your nature.

Your human mind has almost completely dissolved into frog instinct.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'frog',
                    title: 'Perfect Frog Pet',
                    text: `You are Lily's perfect little frog. Your consciousness is minimal—just enough to exist and respond. You sit in your terrarium, responding to warmth, to stimulus, to Lily's presence.

She plays with you. She stimulates you. She uses you according to her desires. You croak and respond without understanding, driven by pure frog instinct.

This is all you are. This is all you will ever be.`,
                    choices: [
                        { text: 'Accept your form', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CONVERGENT STAGES 6+
                {
                    stage: 6,
                    title: 'Pet Transformation Complete',
                    text: `You are Lily's pet. Whether worm, bug, monkey, or frog, you are completely transformed. Your human consciousness is locked away, replaced by animal instinct.

You exist entirely for Lily's pleasure and control. There is no escape. There is only your animal form and your complete dependence on her.`,
                    choices: null,
                    imageUrl: null,
                    onComplete: {
                        action: 'redirect',
                        page: 'States/transformation-trapped.html',
                        duration: 3*60*60*1000
                    }
                },
                {
                    stage: 7,
                    title: 'Lily\'s Creature',
                    text: `Days blur together in your animal existence. You no longer remember being human. You are what Lily made you. You exist in your habitat, responding to her, depending on her.

She cares for you. She uses you. She loves you in the way someone loves a pet.

This is your life now.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 8,
                    title: 'Beloved Pet',
                    text: `You have been Lily's creature for so long that it feels like forever. You are perfect in your animal nature. You respond to her without thought. You obey without question.

Lily treasures you. You are hers. And you are completely content with this.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 9,
                    title: 'Eternal Pet',
                    text: `Forever is being Lily's creature. Forever is your animal existence. Forever is perfect.

You are exactly what you were meant to become. And there is nothing but contentment in that.`,
                    choices: [
                        { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                    ],
                    imageUrl: null
                }
            ]
        };

        // ============================================
        // END OF CHARACTER DATA PART 2
        // ============================================
        // Part 3 will contain: Craftsmen, Morrigan + Random Encounters + Event Handlers
        // ============================================

        // ============================================
        // CHARACTER DATA - PART 3: AMY & MORRIGAN
        // ============================================
        // AMY TRANSFORMATIONS: Horse, Cow, Bird, Snail
        // THEME: Animal (Physical animal transformation)
        // MORRIGAN TRANSFORMATIONS: Pig, Mouse, Cat, Guinea Pig
        // THEME: Animal (Physical animal transformation)

        characterData.amy = {
            name: 'Amy',
            role: 'Tiny Beast Tamer',
            location: 'Workshop',
            badge: 'Small Animal Specialist',
            color: '#e67e22',
            image: 'https://via.placeholder.com/240x240?text=Amy&bg=e67e22&fg=FFFFFF',
            transformType: 'Animal',
            details: 'A miniature woman with the power to transform people into various animals. She specializes in medium-sized creatures that she can control and ride.',
            interactions: [
                {
                    stage: 1,
                    title: 'The Tiny Tamer',
                    text: `The workshop is small—built to Amy's scale. She's only about three feet tall, but the power radiating from her is immense. She's examining tools and ropes when you arrive.

"Welcome, guest," she says, looking up at you with eyes that glitter with intelligence. "I transform people into animals. Horses. Cows. Birds. Snails. Each one perfect for Amy's purposes."

She smiles, and there's something unsettling about how a tiny woman can seem so dominant.

"Which form calls to you? Or shall Amy decide what you'll become?"`,
                    choices: [
                        { text: 'Ask about the forms', next: 2, risk: 'high' },
                        { text: 'Try to refuse her', next: 2, risk: 'medium' },
                        { text: 'Refuse to transform', next: 2, risk: 'low' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 2,
                    title: 'Choosing Your Form',
                    text: `Amy pulls out four bottles, each containing a glowing liquid.

"Horse—strong, fast, enduring. Useful for pulling or riding. Built for power and speed. Cow—docile, controllable, easy to manage. Built for comfort and milk. Bird—free but caged by nature. Built for flight but easily controlled. Snail—slow, vulnerable, completely helpless. Built for nothing but submission."

She holds them up to the light.

"Pick one. Or Amy picks for you. Either way, you're drinking one of these."`,
                    choices: [
                        { text: 'Choose horse', next: 3, risk: 'high', variant: 'horse' },
                        { text: 'Choose cow', next: 3, risk: 'high', variant: 'cow' },
                        { text: 'Choose bird', next: 3, risk: 'high', variant: 'bird' },
                        { text: 'Choose snail', next: 3, risk: 'high', variant: 'snail' }
                    ],
                    imageUrl: null
                },
                // HORSE PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'horse',
                    title: 'Horse Potion',
                    text: `The liquid goes down smoothly. Immediately, your body begins to change. Your bones crack and reform. Your muscles expand and strengthen. Your face elongates. Hooves form on your feet.

"There we go," Amy says happily, watching you grow larger and more powerful. "A perfect horse for Amy. Strong, fast, beautiful."

You're becoming a magnificent creature. Power surges through you but your consciousness is fading.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'horse',
                    title: 'Equine Power',
                    text: `You are a beautiful horse now. Strong. Powerful. Muscles rippling. Your new form is stunning, but your mind is almost gone.

Amy approaches with a bridle and saddle. You try to resist but your horse nature is already taking over. She climbs onto your back.

"Perfect," she coos, riding you around the workshop. "You're exactly what Amy needed. My perfect horse."

You carry her without question, though a tiny part of you screams inside.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'horse',
                    title: 'Amy\'s Steed',
                    text: `You are fully transformed into a horse. You exist to carry Amy. Your consciousness is barely a whisper underneath pure horse instinct. You obey. You carry her. You exist only to serve her.

Days blur together in simple existence. Eating. Being ridden. Obeying. This is all you need. This is all you are.`,
                    choices: [
                        { text: 'Accept your role', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // COW PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'cow',
                    title: 'Cow Potion',
                    text: `The liquid goes down smoothly. Your body transforms differently. Your frame widens and becomes stockier. Your skin becomes thick. Udders form. You're becoming a cow.

"There we go," Amy says, admiring her work. "A perfect dairy cow. Docile. Useful. Beautiful in her own way."

Your transformation is rapid. Your consciousness is dissolving into bovine instinct.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'cow',
                    title: 'Bovine Contentment',
                    text: `You're a cow now. Docile. Stocky. Designed for milk production. Amy leads you to her barn and you follow without resistance. Your cow mind knows only that Amy is authority.

She milks you, and the sensation is intense and pleasurable in a strange bovine way. Your udders are sensitive. Your existence is becoming simple: eat, be milked, exist.

Your human consciousness is nearly gone.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'cow',
                    title: 'Perfect Dairy Cow',
                    text: `You are Amy's perfect cow. Your entire existence revolves around simple bovine needs. Eating. Being milked. Existing. Your human thoughts are completely gone.

You are content in your simplicity. Amy cares for you well. You produce milk for her. This is your purpose. This is your life.`,
                    choices: [
                        { text: 'Accept your role', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // BIRD PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'bird',
                    title: 'Bird Potion',
                    text: `The liquid goes down smoothly. Your body transforms drastically. Your arms become wings. Your legs thin and become talons. Feathers sprout across your body. You're becoming a bird.

"There we go," Amy says, watching you shrink and transform. "A perfect bird for Amy. Free to fly but completely trapped by nature."

Your transformation is nearly complete. Your consciousness is merging with bird instinct.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'bird',
                    title: 'Caged Flight',
                    text: `You're a bird now. You can fly. You want to fly. But Amy has you in a beautiful cage with open sides. You can see the sky but you don't leave. Your bird nature keeps you returning to her.

She feeds you. She cares for you. She lets you perch on her shoulder. Your bird consciousness knows only: Amy is safe. Amy provides. Stay with Amy.

Your human mind is almost completely gone.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'bird',
                    title: 'Amy\'s Bird',
                    text: `You are Amy's perfect bird. You have the illusion of freedom—you can fly anywhere—but you choose to stay. You choose to return to her. Your bird nature is completely dominant now.

You exist to sing for her. To fly for her. To perch on her and respond to her presence. You are free but completely bound to her.`,
                    choices: [
                        { text: 'Accept your role', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // SNAIL PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'snail',
                    title: 'Snail Potion',
                    text: `The liquid goes down smoothly. Your body transforms completely. Your frame compresses. A shell grows from your back. Your limbs become soft and boneless. You're becoming a snail.

"There we go," Amy says softly, watching your transformation. "The most vulnerable. The most helpless. The most perfectly enslaved."

Your transformation is nearly complete. Your consciousness is dissolving into snail simplicity.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'snail',
                    title: 'Slow Prisoner',
                    text: `You're a snail now. Slow. Vulnerable. Completely helpless. Amy keeps you in a perfect habitat, but you can barely move away from her. Your snail nature doesn't even try.

She watches you. She touches you gently. Your snail consciousness knows only: Amy is here. Amy is safe. Exist.

Your human mind is completely obliterated.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'snail',
                    title: 'Amy\'s Pet Snail',
                    text: `You are Amy's perfect snail. Helpless. Slow. Completely dependent. You exist in the space Amy creates for you. You have no thoughts beyond simple animal response.

You are the ultimate captive. The ultimate expression of Amy's complete control. And in your snail consciousness, this is perfect.`,
                    choices: [
                        { text: 'Accept your role', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CONVERGENT STAGES 6+
                {
                    stage: 6,
                    title: 'Amy\'s Beast',
                    text: `You are Amy's animal now. Whether horse, cow, bird, or snail, you exist only to serve her purposes. Your human consciousness is locked away beneath animal instinct.

You are completely hers. Completely dependent. Completely transformed.`,
                    choices: null,
                    imageUrl: null,
                    onComplete: {
                        action: 'redirect',
                        page: 'States/transformation-trapped.html',
                        duration: 3*60*60*1000
                    }
                },
                {
                    stage: 7,
                    title: 'Perfect Animal',
                    text: `You are Amy's perfect creature. You exist according to your nature. She cares for you. She uses you. You are content in your animal existence.

Days blur together in simple, fulfilling routine. This is all you are now. This is all you will ever be.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 8,
                    title: 'Amy\'s Beloved',
                    text: `You have served Amy for a long time now. You are no longer aware of being human. You are what she made you. You are hers.

And you love her in the simple way that animals love their masters.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 9,
                    title: 'Forever Hers',
                    text: `Forever is being Amy's animal. Forever is service. Forever is contentment in your transformed existence.

You are exactly what you were meant to become.`,
                    choices: [
                        { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                    ],
                    imageUrl: null
                }
            ]
        };

        characterData.morrigan = {
            name: 'Morrigan',
            role: 'The Alchemist',
            location: 'Basement',
            badge: 'Creature Master',
            color: '#34495e',
            image: 'https://via.placeholder.com/240x240?text=Morrigan&bg=34495e&fg=FFFFFF',
            transformType: 'Animal',
            details: 'A dark alchemist who transforms people into small animals—pigs, mice, cats, guinea pigs. She keeps them caged and experimented on.',
            interactions: [
                {
                    stage: 1,
                    title: 'The Alchemist\'s Lair',
                    text: `The basement is filled with cages. Lots of them. And inside those cages are creatures. Squeaking. Meowing. Moving around in confused panic.

Morrigan stands at the center, ancient and cruel. She\'s stirring a massive cauldron filled with bubbling liquid.

"Another test subject," she says without looking up. "You\'ve chosen the worst place to wander. But how fortunate for me. How unfortunate for you."

She finally turns to face you, and her smile is cold.

"I take people and turn them into little creatures. Pigs. Mice. Cats. Guinea pigs. Each serves a specific purpose in my research. Each provides different data."`,
                    choices: [
                        { text: 'Try to run', next: 2, risk: 'low' },
                        { text: 'Ask what she\'ll do to you', next: 2, risk: 'high' },
                        { text: 'Demand to leave', next: 2, risk: 'medium' }
                    ],
                    imageUrl: null
                },
                {
                    stage: 2,
                    title: 'Choosing Your Form',
                    text: `Morrigan gestures to four different cauldrons, each bubbling with different colored liquid.

"You have four choices for transformation. Pigs—useful, dirty, controllable, designed for degradation. Mice—small, timid, perfect for observation, designed for fear. Cats—fast, agile, independent yet bound, designed for control. Guinea pigs—small, docile, perfect for experiments, designed for compliance."

She laddles out portions of liquid into four cups.

"Choose which form, or I choose for you. Either way, you drink."`,
                    choices: [
                        { text: 'Choose pig form', next: 3, risk: 'high', variant: 'pig' },
                        { text: 'Choose mouse form', next: 3, risk: 'high', variant: 'mouse' },
                        { text: 'Choose cat form', next: 3, risk: 'high', variant: 'cat' },
                        { text: 'Choose guinea pig form', next: 3, risk: 'high', variant: 'guineapig' }
                    ],
                    imageUrl: null
                },
                // PIG PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'pig',
                    title: 'Pig Transformation Begins',
                    text: `The liquid goes down. Morrigan watches with clinical detachment as you begin to shrink and change. Your body becomes stockier. Your skin becomes thick and pink. A snout forms.

"Excellent," she mutters, making notes. "The pig transformation is proceeding normally. Such useful creatures. So controllable. So trainable."

You're becoming smaller. More animalistic. More degraded.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'pig',
                    title: 'Pig Prisoner',
                    text: `You're in a pig's body now. Small, stocky, covered in coarse hair. Your consciousness is still relatively intact but trapped.

Morrigan places you in a cage with muddy bedding. She studies you as you try to understand your new form. The degradation is intense—a pig's life is dirty, simple, controlled.

"Perfect," she says, taking notes. "Beginning Stage 4 observation protocols."

Your human mind screams, but your pig body can only oink.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'pig',
                    title: 'Complete Pig',
                    text: `You are completely a pig now. Your consciousness has mostly dissolved into pig nature. You exist in mud and filth, eating from troughs, responding only to Morrigan's commands.

She uses you as a test subject, introducing different potions, different stimuli, studying your responses with scientific interest.

You are no longer human. You are a specimen.`,
                    choices: [
                        { text: 'Accept your fate', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // MOUSE PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'mouse',
                    title: 'Mouse Transformation Begins',
                    text: `The liquid goes down. Your body shrinks rapidly. Your bones compress. Your face pinches into a mouse snout. Your ears enlarge. Your tail extends.

"Excellent," Morrigan observes, making rapid notes. "The mouse transformation is proceeding precisely. Such timid little creatures. Perfect for studying fear responses."

You're becoming tiny. Vulnerable. Powerless.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'mouse',
                    title: 'Mouse Prisoner',
                    text: `You're a mouse now. Tiny. Vulnerable. Terrified. Morrigan places you in a small cage with minimal bedding. You try to hide, driven by pure mouse fear.

She observes your behavior, taking notes. She introduces loud noises. You panic. She introduces predator smells. You panic more. Your human consciousness screams inside but your mouse body only knows fear.

"Fascinating fear response," she mutters.

You are a research subject being studied.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'mouse',
                    title: 'Specimen Mouse',
                    text: `You are completely a mouse now. Your consciousness is dominated by fear and survival instinct. You hide. You scurry. You respond to every threat with panic.

Morrigan continues her experiments. Sometimes she runs you through mazes. Sometimes she introduces new stimuli. Always she watches and takes notes.

You are a specimen. You exist only to be studied.`,
                    choices: [
                        { text: 'Accept your fate', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CAT PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'cat',
                    title: 'Cat Transformation Begins',
                    text: `The liquid goes down. Your body compresses and reshapes. Your face flattens into feline features. Fur sprouts. Your limbs rearrange. Claws extend from your paws. Whiskers form.

"Excellent," Morrigan says, her tone showing rare satisfaction. "The cat transformation is proceeding beautifully. Agile. Quick. Independent yet controllable."

You're becoming a cat. Fast. Capable. But still trapped.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'cat',
                    title: 'Caged Cat',
                    text: `You're a cat now. You have agility and grace, but you're in a cage. You can move quickly, but there's nowhere to go. Your cat instincts rage against the confinement.

Morrigan watches your behavior—how you try to escape, how you respond to her presence. She's studying your independence and how to control it.

She dangles toys. You pounce. She withholts food. You comply. Your cat nature is being shaped, controlled, studied.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'cat',
                    title: 'Controlled Cat',
                    text: `You are completely a cat now. You've learned that Morrigan is authority. You're agile and capable, but you don't escape. Your independence has been carefully shaped and controlled.

You respond to her with cat behaviors—sometimes affectionate, sometimes aloof—but always within her control. You are a subject. A specimen. A tool for her study.`,
                    choices: [
                        { text: 'Accept your fate', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // GUINEA PIG PATH (3-5)
                {
                    stage: 3,
                    stageVariant: 'guineapig',
                    title: 'Guinea Pig Transformation',
                    text: `The liquid goes down. Your body shrinks and reshapes. You become rounded. Fur covers you. Your face becomes that of a guinea pig—docile, innocent, completely vulnerable.

"Perfect," Morrigan says, taking notes. "The guinea pig transformation is proceeding excellently. So docile. So compliant. Perfect for all varieties of experimentation."

You're becoming completely harmless. Completely dependent. Completely docile.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 4,
                    stageVariant: 'guineapig',
                    title: 'Guinea Pig Specimen',
                    text: `You're a guinea pig now. Small. Round. Docile. Morrigan places you in a cage with other small animals and begins her experiments immediately.

She introduces various potions, various stimuli. You respond with docile acceptance. Your guinea pig nature is completely compliant. You squeak and respond but never resist.

You are a perfect research subject—compliant, responsive, helpless.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 5,
                    stageVariant: 'guineapig',
                    title: 'Perfect Specimen',
                    text: `You are completely a guinea pig now. Your consciousness has merged with perfect docility. You are completely compliant. You respond to everything Morrigan does with acceptance.

She continues her experiments. You continue to participate. You are exactly what she wanted—a perfect specimen, perfectly compliant, perfectly controllable.`,
                    choices: [
                        { text: 'Accept your fate', next: 6, risk: 'critical' }
                    ],
                    imageUrl: null
                },
                // CONVERGENT STAGES 6+
                {
                    stage: 6,
                    title: 'Laboratory Existence',
                    text: `You are Morrigan's specimen now. Whether pig, mouse, cat, or guinea pig, you exist only for her research. Your human consciousness is locked away.

You are in a cage. You are being studied. You are a research subject. This is your existence now.`,
                    choices: null,
                    imageUrl: null,
                    onComplete: {
                        action: 'redirect',
                        page: 'States/transformation-trapped.html',
                        duration: 3*60*60*1000
                    }
                },
                {
                    stage: 7,
                    title: 'Ongoing Experiments',
                    text: `Days blur together. You're in your cage. Morrigan comes and goes, introducing various substances, observing your responses, taking notes.

You are completely dependent on her for food and water. You are completely under her control. You are completely a specimen.`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 8,
                    title: 'Permanent Fixture',
                    text: `You have been in Morrigan's laboratory for a long time now. You no longer remember being human. You are what you are—pig, mouse, cat, or guinea pig. You exist to be studied.

And slowly, you are becoming accepting of this. What else could you be?`,
                    choices: null,
                    imageUrl: null
                },
                {
                    stage: 9,
                    title: 'Eternal Specimen',
                    text: `Forever is being Morrigan's research subject. Forever is your cage. Forever is your transformation.

You are exactly what you were meant to become. A specimen. A subject. A tool for her endless curiosity.`,
                    choices: [
                        { text: 'End Interaction & Return to Map', next: 'end', risk: 'none' }
                    ],
                    imageUrl: null
                }
            ]
        };

        // ============================================
        // RANDOM ENCOUNTERS SYSTEM
        // ============================================

        const randomEncounters = [
            {
                title: 'Mysterious Visitor',
                text: `You're walking through the halls when suddenly the air grows cold. A cloaked figure materializes from the shadows. Their voice is harsh and direct.

"I can help you transform faster. More completely. More permanently."

They step closer, and you can feel power radiating from them.

"Your choices have been too soft. Too gentle. Let me show you what real transformation feels like. What real surrender feels like."`,
                choices: [
                    { text: 'Accept eagerly', risk: 'critical' },
                    { text: 'Ask what they want', risk: 'high' },
                    { text: 'Refuse politely', risk: 'low' },
                    { text: 'Run away', risk: 'low' }
                ]
            },
            {
                title: 'Magical Artifact Found',
                text: `You find something on the ground—a beautiful object that glows. It calls to you silently. As you touch it, it burns hot in your hands.

"Wear me," it whispers directly into your mind. "Let me become part of you. Together we can be something beautiful. Something perfect."

The artifact pulses with hypnotic light.`,
                choices: [
                    { text: 'Put it on immediately', risk: 'critical' },
                    { text: 'Resist its call', risk: 'high' },
                    { text: 'Drop it and run', risk: 'low' },
                    { text: 'Throw it away', risk: 'low' }
                ]
            },
            {
                title: 'Another Transformed Soul',
                text: `You meet someone wandering the halls. They were human once. Now they\'re something else completely. Peaceful. Content. Utterly transformed.

"Accept it," they tell you quietly. "The struggle ends. The doubts disappear. You become something better. Something perfect."

They smile in a way that\'s both beautiful and unsettling.

"Let go. It\'s so much easier when you just let go."`,
                choices: [
                    { text: 'Listen to their wisdom', risk: 'high' },
                    { text: 'Ask what they became', risk: 'medium' },
                    { text: 'Thank them and leave', risk: 'low' },
                    { text: 'Run from them', risk: 'low' }
                ]
            },
            {
                title: 'Possible Escape Route',
                text: `You find a window. A door. Something that looks like freedom. Your heart races with the possibility of escape.

But something feels wrong about it. The window shows a landscape that shifts. The door hums with strange energy.

This might be a trap. Or it might be your only chance.

What do you do?`,
                choices: [
                    { text: 'Try to escape anyway', risk: 'high' },
                    { text: 'Test it first', risk: 'medium' },
                    { text: 'Approach carefully', risk: 'medium' },
                    { text: 'Accept you can\'t leave', risk: 'low' }
                ]
            },
            {
                title: 'Whispers in the Darkness',
                text: `Late at night, you hear hundreds of voices whispering from the walls. They\'re the voices of everyone this house has transformed.

"Let go..." they whisper. "Stop fighting... Acceptance is peace... Join us..."

They know your deepest desires. They know what you\'re afraid to admit. They know you\'re curious about what you could become.

The whispers grow louder, more insistent.`,
                choices: [
                    { text: 'Answer the whispers', risk: 'critical' },
                    { text: 'Listen but resist', risk: 'medium' },
                    { text: 'Block them out', risk: 'low' },
                    { text: 'Demand they stop', risk: 'high' }
                ]
            }
        ];

        // ============================================
        // INITIALIZATION & EVENT SYSTEM
        // ============================================

        // Initialize the page
        function initializePage() {
            loadGameState();
            setupEventListeners();
            closeInteraction();
        }

        // Event listener setup
        function setupEventListeners() {
            // Add click handlers to location cards
            const locationCards = document.querySelectorAll('.location-card');
            locationCards.forEach(card => {
                card.addEventListener('click', function() {
                    const character = this.getAttribute('data-character');
                    if (character && characterData[character]) {
                        startInteraction(character);
                    }
                });
            });

            // Back/Close button in interaction
            const closeInteractionBtn = document.getElementById('closeInteraction');
            if (closeInteractionBtn) {
                closeInteractionBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    closeInteraction();
                });
            }

            // Menu toggle
            const menuToggle = document.getElementById('menuToggle');
            const menuClose = document.getElementById('menuClose');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    mobileMenu.style.display = mobileMenu.style.display === 'none' ? 'block' : 'none';
                });
            }
            
            if (menuClose) {
                menuClose.addEventListener('click', function() {
                    mobileMenu.style.display = 'none';
                });
            }
        }

        // ============================================
        // RANDOM ENCOUNTERS SYSTEM
        // ============================================
        
        function startRandomEncounter() {
            if (!randomEncounters || randomEncounters.length === 0) return;
            
            const encounter = randomEncounters[Math.floor(Math.random() * randomEncounters.length)];
            
            gameState.currentCharacter = 'random';
            gameState.currentStage = 1;
            
            // Hide map, show interaction view
            const mapView = document.querySelector('.map-view');
            const interactionView = document.querySelector('.interaction-view');
            
            if (mapView) mapView.style.display = 'none';
            if (interactionView) interactionView.style.display = 'flex';
            
            // Update character panel for random encounter
            const charName = document.getElementById('charName');
            const charRole = document.getElementById('charRole');
            const charImage = document.getElementById('charImage');
            const stageNumber = document.getElementById('stageNumber');
            const affinityValue = document.getElementById('affinityValue');
            const transformValue = document.getElementById('transformValue');
            const riskValue = document.getElementById('riskValue');
            
            if (charName) charName.textContent = 'Random Encounter';
            if (charRole) charRole.textContent = 'Mysterious Event';
            if (charImage) charImage.src = 'https://via.placeholder.com/240x240?text=Mystery&bg=4B0082&fg=FFFFFF';
            if (stageNumber) stageNumber.textContent = '1/1';
            if (affinityValue) affinityValue.textContent = '0%';
            if (transformValue) transformValue.textContent = 'Surprise!';
            if (riskValue) riskValue.textContent = 'Unknown';
            
            // Display encounter
            displayRandomEncounter(encounter);
        }
        
        function displayRandomEncounter(encounter) {
            const dialogueBox = document.getElementById('dialogueBox');
            const dialogueText = document.getElementById('dialogueText');
            const dialogueName = document.getElementById('dialogueName');
            const dialogueStage = document.getElementById('dialogueStage');
            const progressText = document.getElementById('progressText');
            const stageProgressFill = document.getElementById('stageProgressFill');
            const choicesContainer = document.getElementById('choicesContainer');
            
            if (dialogueBox) {
                dialogueBox.classList.add('random-encounter');
            }
            
            if (dialogueText) dialogueText.textContent = encounter.text;
            if (dialogueName) dialogueName.textContent = 'Mystery Event';
            if (dialogueStage) dialogueStage.textContent = 'Stage 1';
            if (progressText) progressText.textContent = 'One Time Event';
            if (stageProgressFill) stageProgressFill.style.width = '100%';
            
            // Clear and add encounter choices
            if (choicesContainer) {
                choicesContainer.innerHTML = '<div class="choices-title">Choose Your Response:</div>';
                
                encounter.choices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    const letter = String.fromCharCode(65 + index);
                    btn.innerHTML = `
                        <span class="choice-icon">${letter}</span>
                        <span class="choice-text">${choice.text}</span>
                        <span class="choice-risk">[${choice.risk.toUpperCase()}]</span>
                    `;
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        closeInteraction();
                    });
                    choicesContainer.appendChild(btn);
                });
            }
        }

        // Start interaction with character
        function startInteraction(characterKey) {
            // 20% chance for random encounter
            if (Math.random() < 0.20) {
                startRandomEncounter();
                return;
            }
            
            if (!characterData[characterKey]) return;
            
            gameState.currentCharacter = characterKey;
            gameState.currentStage = 1;
            gameState.currentInteraction = characterData[characterKey];
            
            // Hide map, show interaction view
            const mapView = document.querySelector('.map-view');
            const interactionView = document.querySelector('.interaction-view');
            
            if (mapView) mapView.style.display = 'none';
            if (interactionView) interactionView.style.display = 'flex';
            
            // Display the interaction
            displayInteraction();
        }

        // Display current interaction
        function displayInteraction() {
            const character = gameState.currentInteraction;
            // Support stage variants (multi-path transformations)
            let stage = character.interactions.find(s => 
                s.stage === gameState.currentStage && 
                (!s.stageVariant || s.stageVariant === gameState.transformationVariant)
            );
            // If no variant match, use first stage of this number
            if (!stage) {
                stage = character.interactions[gameState.currentStage - 1];
            }
            
            if (!stage) return;
            
            // Initialize character affinity if not exists
            if (!gameState.characterAffinity[gameState.currentCharacter]) {
                gameState.characterAffinity[gameState.currentCharacter] = 0;
            }
            if (!gameState.characterTransform[gameState.currentCharacter]) {
                gameState.characterTransform[gameState.currentCharacter] = 0;
            }
            
            // Update character panel
            const charName = document.getElementById('charName');
            const charRole = document.getElementById('charRole');
            const charImage = document.getElementById('charImage');
            const stageNumber = document.getElementById('stageNumber');
            const affinityValue = document.getElementById('affinityValue');
            const transformValue = document.getElementById('transformValue');
            const riskValue = document.getElementById('riskValue');
            const affinityBar = document.getElementById('affinityBar');
            const transformBar = document.getElementById('transformBar');
            const dialogueText = document.getElementById('dialogueText');
            const dialogueName = document.getElementById('dialogueName');
            const dialogueStage = document.getElementById('dialogueStage');
            const progressText = document.getElementById('progressText');
            const stageProgressFill = document.getElementById('stageProgressFill');
            const charDetails = document.getElementById('charDetails');
            const charTransformType = document.getElementById('charTransformType');
            const riskDescription = document.getElementById('riskDescription');
            
            if (charName) charName.textContent = character.name;
            if (charRole) charRole.textContent = character.role;
            if (charImage) charImage.src = character.image;
            if (stageNumber) stageNumber.textContent = gameState.currentStage + '/9';
            if (dialogueText) dialogueText.textContent = stage.text;
            if (dialogueName) dialogueName.textContent = character.name;
            if (dialogueStage) dialogueStage.textContent = 'Stage ' + gameState.currentStage;
            if (progressText) progressText.textContent = 'Stage ' + gameState.currentStage + ' of 9';
            
            // Update stats with character-specific values
            const charAffinity = gameState.characterAffinity[gameState.currentCharacter] || 0;
            const charTransform = gameState.characterTransform[gameState.currentCharacter] || 0;
            
            if (affinityValue) affinityValue.textContent = charAffinity + '%';
            if (transformValue) transformValue.textContent = character.transformType;
            if (riskValue) riskValue.textContent = gameState.riskLevel;
            if (affinityBar) affinityBar.style.width = charAffinity + '%';
            if (transformBar) transformBar.style.width = charTransform + '%';
            
            // Update character details
            if (charDetails) {
                charDetails.textContent = character.details || character.name + ' is a powerful presence in this house.';
            }
            if (charTransformType) {
                charTransformType.textContent = 'You may transform into: ' + character.transformType;
            }
            
            // Update risk description based on level
            if (riskDescription) {
                const riskMap = {
                    'Low': 'Safe - Reversible changes',
                    'Medium': 'Moderate - Some changes may persist',
                    'High': 'Dangerous - Significant transformation occurring',
                    'Critical': 'Extreme - Irreversible transformation imminent'
                };
                riskDescription.textContent = riskMap[gameState.riskLevel] || 'Unknown';
            }
            
            // Update stage progress bar
            if (stageProgressFill) {
                const progress = (gameState.currentStage / 9) * 100;
                stageProgressFill.style.width = progress + '%';
            }
            
            // Update choices
            updateChoices(stage.choices);
        }

        // Update choice buttons
        function updateChoices(choices) {
            const choicesContainer = document.getElementById('choicesContainer');
            if (!choicesContainer) return;
            
            // Clear existing choices
            const existingButtons = choicesContainer.querySelectorAll('.choice-btn:not(.choices-title)');
            existingButtons.forEach(btn => btn.style.display = 'none');
            
            if (!choices) {
                // Auto-advance to next stage
                const continueBtn = document.createElement('button');
                continueBtn.className = 'choice-btn';
                continueBtn.innerHTML = '<span class="choice-icon">→</span><span class="choice-text">Continue to Next Stage</span>';
                continueBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (gameState.currentStage < 9) {
                        gameState.currentStage++;
                        saveGameState();
                        displayInteraction();
                    }
                });
                choicesContainer.appendChild(continueBtn);
            } else {
                choices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    const letter = String.fromCharCode(65 + index);
                    btn.innerHTML = `
                        <span class="choice-icon">${letter}</span>
                        <span class="choice-text">${choice.text}</span>
                        <span class="choice-risk">[${choice.risk.toUpperCase()}]</span>
                    `;
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Track transformation variant if specified in choice
                        if (choice.variant) {
                            gameState.transformationVariant = choice.variant;
                        }
                        
                        // Apply stat changes based on choice
                        if (choice.risk === 'low') {
                            gameState.characterAffinity[gameState.currentCharacter] = Math.min(100, (gameState.characterAffinity[gameState.currentCharacter] || 0) + 5);
                            gameState.characterTransform[gameState.currentCharacter] = Math.min(100, (gameState.characterTransform[gameState.currentCharacter] || 0) + 8);
                            gameState.riskLevel = 'Low';
                        } else if (choice.risk === 'medium') {
                            gameState.characterAffinity[gameState.currentCharacter] = Math.min(100, (gameState.characterAffinity[gameState.currentCharacter] || 0) + 8);
                            gameState.characterTransform[gameState.currentCharacter] = Math.min(100, (gameState.characterTransform[gameState.currentCharacter] || 0) + 12);
                            gameState.riskLevel = 'Medium';
                        } else if (choice.risk === 'high') {
                            gameState.characterAffinity[gameState.currentCharacter] = Math.min(100, (gameState.characterAffinity[gameState.currentCharacter] || 0) + 12);
                            gameState.characterTransform[gameState.currentCharacter] = Math.min(100, (gameState.characterTransform[gameState.currentCharacter] || 0) + 18);
                            gameState.riskLevel = 'High';
                        } else if (choice.risk === 'critical') {
                            gameState.characterAffinity[gameState.currentCharacter] = Math.min(100, (gameState.characterAffinity[gameState.currentCharacter] || 0) + 20);
                            gameState.characterTransform[gameState.currentCharacter] = Math.min(100, (gameState.characterTransform[gameState.currentCharacter] || 0) + 25);
                            gameState.riskLevel = 'Critical';
                        }
                        
                        // Check if current stage has completion trigger
                        const currentStage = gameState.currentInteraction.interactions[gameState.currentStage - 1];
                        if (currentStage && currentStage.onComplete) {
                            // Trigger transformation completion
                            triggerTransformationCompletion(currentStage.onComplete);
                        } else if (choice.next === 'end') {
                            closeInteraction();
                        } else {
                            gameState.currentStage = choice.next;
                            saveGameState();
                            displayInteraction();
                        }
                    });
                    choicesContainer.appendChild(btn);
                });
            }
        }

        // Save game state to localStorage
        function saveGameState() {
            localStorage.setItem('farmhouseGameState', JSON.stringify(gameState));
            showNotification('Progress saved!');
        }

        // Load game state from localStorage
        function loadGameState() {
            const saved = localStorage.getItem('farmhouseGameState');
            if (saved) {
                const loaded = JSON.parse(saved);
                gameState = { ...gameState, ...loaded };
            }
        }

        // Close interaction and return to map
        function closeInteraction() {
            const interactionView = document.getElementById('interactionView');
            const mapView = document.getElementById('mapView');
            const dialogueBox = document.getElementById('dialogueBox');
            
            if (interactionView) {
                interactionView.style.display = 'none';
            }
            if (mapView) {
                mapView.style.display = 'block';
            }
            if (dialogueBox) {
                dialogueBox.classList.remove('random-encounter');
            }
            
            gameState.currentCharacter = null;
            gameState.currentStage = 1;
            saveGameState();
        }

        function showNotification(message) {
            console.log(message);
        }

        // Trigger transformation completion - redirect to state file
        function triggerTransformationCompletion(completionData) {
            if (!completionData || completionData.action !== 'redirect') return;
            
            // State file mapping for each character-form combination
            const stateFileMap = {
                'Scarlet-horse': 'States/farmhouse-scarlet-horse.html',
                'Scarlet-cow': 'States/farmhouse-scarlet-cow.html',
                'Scarlet-donkey': 'States/farmhouse-scarlet-donkey.html',
                'Scarlet-rabbit': 'States/farmhouse-scarlet-rabbit.html',
                'Scarlet-dog': 'States/farmhouse-scarlet-dog.html',
                'Iris-maid': 'States/farmhouse-iris-maid.html',
                'Iris-bimbo': 'States/farmhouse-iris-bimbo.html',
                'Iris-slave': 'States/farmhouse-iris-slave.html',
                'Aelindor-pussy': 'States/farmhouse-aelindor-pussy.html',
                'Aelindor-breasts': 'States/farmhouse-aelindor-breasts.html',
                'Aelindor-ass': 'States/farmhouse-aelindor-ass.html',
                'Aelindor-anus': 'States/farmhouse-aelindor-anus.html',
                'Aelindor-cock': 'States/farmhouse-aelindor-cock.html',
                'Sparkle-dildo': 'States/farmhouse-sparkle-dildo.html',
                'Sparkle-fleshlight': 'States/farmhouse-sparkle-fleshlight.html',
                'Sparkle-buttplug': 'States/farmhouse-sparkle-buttplug.html',
                'Lily-worm': 'States/farmhouse-lily-worm.html',
                'Lily-bug': 'States/farmhouse-lily-bug.html',
                'Lily-monkey': 'States/farmhouse-lily-monkey.html',
                'Lily-frog': 'States/farmhouse-lily-frog.html',
                'Amy-horse': 'States/farmhouse-amy-horse.html',
                'Amy-cow': 'States/farmhouse-amy-cow.html',
                'Amy-bird': 'States/farmhouse-amy-bird.html',
                'Amy-snail': 'States/farmhouse-amy-snail.html',
                'Morrigan-pig': 'States/farmhouse-morrigan-pig.html',
                'Morrigan-mouse': 'States/farmhouse-morrigan-mouse.html',
                'Morrigan-cat': 'States/farmhouse-morrigan-cat.html',
                'Morrigan-guineapig': 'States/farmhouse-morrigan-guineapig.html'
            };
            
            // Save transformation state
            const state = JSON.parse(localStorage.getItem('farmState') || '{}');
            
            // Determine which form was selected
            const formKey = gameState.currentCharacter + '-' + (gameState.transformationVariant || 'default');
            state.currentForm = formKey;
            state.trappedUntil = Date.now() + (completionData.duration || 3 * 60 * 60 * 1000); // Default 3 hours
            
            localStorage.setItem('farmState', JSON.stringify(state));
            
            // Redirect to form-specific state page using map, fallback to universal page
            const redirectPage = stateFileMap[formKey] || 'States/transformation-trapped.html';
            window.location.href = redirectPage;
        }

        // Initialize on page load
        window.addEventListener('load', initializePage);

    </script>

</body>
</html>
